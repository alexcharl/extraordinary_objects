function chooseSearchTerm(){chosenSearchTerm=theSearchTerms[pumkin.randomNum(0,theSearchTerms.length)]}function start(){console.log("looking for  user settings"),"undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.sync.get({userSearchTerms:"",strictSearch:"fuzzy"},function(e){e.userSearchTerms.length>0?(console.log("using user search terms: "+e.userSearchTerms),theSearchTerms=e.userSearchTerms.replace(/ /g,"+").split(",")):(console.log("using default search terms: "+defaultSearchTerms),theSearchTerms=defaultSearchTerms),console.log("strictSearch setting = "+e.strictSearch),"strict"==e.strictSearch&&(strictSearch=!0),chooseSearchTerm(),makeVaRequest(null,chosenSearchTerm)}):(console.log("Running as standalone page, using default search terms: "+defaultSearchTerms),theSearchTerms=defaultSearchTerms,chooseSearchTerm(),makeVaRequest(null,chosenSearchTerm))}function makeVaRequest(e,t,o,a,n,r,i,s){if(searchCount<maxSearchCounts){searchCount++,e=void 0!==e?e:null,n=void 0!==n?n:"1",a=void 0!==a?a:"1",t=void 0!==t?t:null,o=void 0!==o?o:null,r=void 0!==r?r:"1",i=void 0!==i?i:null,s=void 0!==s?s:"0",quality="undefined"!=typeof quality?quality:null;var c=0;if(null!=o?c=1:null!=e&&(c=2),1==strictSearch)var l=t,t=null;else var l=null;console.log("strictSearch = "+strictSearch);var h="";h=null!=e?vaUrl+e:vaUrl,console.log("expectResponse = "+c),console.log("queryUrl = "+h),console.log("Chosen term = "+t),console.log("Chosen item name = "+l),console.log("offset = "+o),$.ajax({type:"get",url:h,dataType:"json",cache:!1,data:{images:n,limit:a,offset:o,quality:quality,pad:r,after:i,kw_object_name:l,kw_system_number:t},error:function(e,t,o){console.log("error status= "+t),console.log("error thrown= "+o)}}).done(function(e){console.log("done"),processResponse(e,c)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}else console.log("maximum number of search attempts reached, try changing search terms"),SITE.throwError()}function processResponse(e,t){if(console.log(e),0!==t){if(1===t){var o=e.records.length;console.log("There are "+o+" objects available.");return void makeVaRequest(e.records[pumkin.randomNum(0,o)].fields.systemNumber)}var a=e[0].fields,n=a.primaryImageId,r=a.object,i=""!=a.title?a.title:a.object,s=a.yearStart,c=a.slug,l=a.artist,h=a.systemNumber,d=a.materialsTechniques,u=a.publicAccessDescription,m=a.historicalContextNote;if(void 0!==a.names[0])var p=a.names[0].fields;if(void 0!==p)var g=void 0===p.deathYear||0==p.deathYear,f=g||null==p.deathYear?"Born ":"",v=g||null==p.deathYear?"":" - "+p.deathYear,b=null!=p.birthYear&&0!=p.deathYear?f+p.birthYear+v:"",b=""!=b&&"I"!=b?"("+b+")":"";var y="https://framemark.vam.ac.uk/collections/"+n+"/full/1000,/0/default.jpg",T=vaCollectionsUrl+h+"/"+c,C=a.physicalDescription,w=a.dimensions,S=a.place,k=a.museumNumber,x=a.location;i=i.replace(/\^/,""),i=i.replace(/\<i\>/g,""),i=i.replace(/\<\\i\>/g,""),i=i.replace(/\<b\>/g,""),i=i.replace(/\<\\b\>/g,"");var I="<strong>"+i+" "+s+"</strong> &mdash; "+l+" "+b;u=u.replace(/Object Type\n/g,""),u=u.replace(/People\n/g,""),u=u.replace(/Place\n/g,""),u=u.replace(/Places\n/g,""),u=u.replace(/Time\n/g,""),u=u.replace(/Design \& Designing\n/g,""),u=u.replace(/Design\n/g,""),u=u.replace(/Subject Depicted\n/g,""),u=u.replace(/Subjects Depicted\n/g,""),u=u.replace(/Materials \& Making\n/g,""),u=u.replace(/Collectors \& Owners\n/g,""),u=u.replace(/Ownership \& Use\n/g,""),u=u.replace(/Trading\n/g,""),u=u.replace(/Trade\n/g,""),u=u.replace(/Historical Associations\n/g,""),u=u.replace(/Other\n/g,""),u=u.replace(/\n\n\n/g,"\n\n"),u=u.replace(/\n/g,"<br>"),u=u.replace(/\<i\>/g,""),u=u.replace(/\<\\i\>/g,""),u=u.replace(/\<b\>/g,""),u=u.replace(/\<\\b\>/g,""),C=C.replace(/\<i\>/g,""),C=C.replace(/\<\\i\>/g,""),C=C.replace(/\<b\>/g,""),C=C.replace(/\<\\b\>/g,""),s=void 0!==s&&null!=s?s:"";var _="https://www.pinterest.com/pin/create/button/";_+="?url="+T,_+="&media="+y,_+="&description="+i,""!=s&&(_+=" ("+S+", "+s+")"),_+=", V%26A Collection",i.length>42&&($("#title").addClass("reduced"),$("#piece-date").addClass("reduced")),$("#creator-name").text(l),$("#dates-alive").text(b),$("#title").html(i),""!=s&&$("#piece-date").text("("+s+")"),$("#place").html(S),$("#image").attr("src",y),$("#pinterest-button").attr("href",_),$("#page-link").attr("href",T);var A=u&&u.trim()!==""?u:"No description available for this object.";$("#object-description").html("<p>"+A+"</p>"),$("#object-context").html("<p>"+m+"</p>"),$("#object-side-caption").html(I),""!=C?$("#physical-description").html(C):(console.log("hiding physical description"),$("#physical-description").hide(),$("#physical-description").prev("h4").hide()),""!=s?$("#tech-info-piece-date").text(s):($("#tech-info-piece-date").hide(),$("#tech-info-piece-date").prev("h4").hide()),""!=l?$("#tech-info-creator-name").text(l):($("#tech-info-creator-name").hide(),$("#tech-info-creator-name").prev("h4").hide()),""!=d?$("#tech-info-materials").html(d):($("#tech-info-materials").hide(),$("#tech-info-materials").prev("h4").hide()),""!=S?$("#tech-info-place").text(S):($("#tech-info-place").hide(),$("#tech-info-place").prev("h4").hide()),""!=w?$("#dimensions").text(w):($("#dimensions").hide(),$("#dimensions").prev("h4").hide()),""!=x?$("#museum-location").text(x):($("#museum-location").hide(),$("#museum-location").prev("h4").hide()),""!=k?$("#museum-number").text(k):($("#museum-number").hide(),$("#museum-number").prev("h4").hide()),SITE.onThrottledResize(),$(".content-placeholder, .hide-until-loaded").addClass("loaded"),$("img.image-hide-until-loaded").load(function(){$(".image-hide-until-loaded, .hide-after-loaded").addClass("loaded")})}else{var o=e.records.length;if(o>0){var j=pumkin.randomNum(0,e.meta.result_count-1);console.log("total results = "+e.meta.result_count),console.log("making query 2, with randomOffset of "+j),makeVaRequest(null,chosenSearchTerm,j)}else console.log("making a second request, no results found last time"),chooseSearchTerm(),makeVaRequest(null,chosenSearchTerm)}}function handleError(e,t,o){console.log("Error was: "+o)}var pumkin=window.pumkin={};!function(e,t,o){function a(e,t){var o=e.css("transform"),a=o.match(/-?[0-9\.]+/g),n=a[0],r={x:a[4]/n,y:a[5]/n};return"scale"===t?n:"translate"===t?r:"raw"===t?a:void 0}function n(t){return t=t||e.event,t.keyCode}function r(e,o){o=o||"active",t(e).each(function(){var e=t(this),a=e.data().placeholder;e.val(a),""===t.trim(e.val())&&e.val(a).removeClass(o),e.focus(function(){e.val()===a&&e.val("").addClass(o)}).blur(function(){""===t.trim(e.val())&&e.val(a).removeClass(o)})})}function i(){t("img[src$='.svg']").each(function(){var e=t(this),o=e.attr("src"),a=o.replace(".svg",".png");e.attr("src",a)})}function s(e){var o=0;e.each(function(){o=Math.max(t(this).height(),o)}),e.each(function(){t(this).height(o)})}function c(e,t){return Math.floor(Math.random()*(t-e)+e)}function l(e,o,a,n,r,i,s){console.log("autoFit: "+o.length),a=a||0;var c=e.width()-a;o.removeAttr("style");var l=[],h=0,d=[];o.each(function(){var e=t(this);h+=parseInt(e.css("width"))+a,h<=c?d.push(e):(l.push(d),d=new Array(e),h=parseInt(e.css("width"))+a),e.is(":last-child")&&r&&l.push(d)});for(var u=l.length,m=0;m<u;m++){for(var p=l[m].length,g=0,f=0;f<p;f++)g+=parseInt(l[m][f].css("width"))+a;var v=c-g,$=v/p,b=g/p,y=0;if(s){parseInt(l[0][0].css("width"))}for(f=0;f<p;f++){var T,C=parseInt(l[m][f].css("width")),w=C/b,S=s?C+$:C+Math.floor($*w);if(0===m&&0===f){var k=parseInt(l[m][f].css("height"));T=n?Math.floor(S*(k/C)):k}i?l[m][f].css({width:S}):l[m][f].css({width:S,height:T}),y+=S+a}var x=c-y;l[m][p-1].css("width",parseInt(l[m][p-1].css("width"))+x)}}function h(e,o,a){a="function"==typeof imagesLoaded&&a,e.each(function(){var e=t(this),o=o||e.data("src");a&&e.css({opacity:0}),e.attr("src")||(e.attr("src",o),console.log("INTELLILOAD: is image?"+e.is("img")),a&&e.is("img")&&(console.log("INTELLILOAD: revlealOnLoad: "+o),e.imagesLoaded().done(function(e,t){console.log("INTELLILOAD: imagesLoaded: "+t.attr("src")),t.css({opacity:1})})))})}function d(){var e;return e={isMobile:"visible"===t("#mobileTester").css("visibility"),isTablet:"visible"===t("#tabletTester").css("visibility"),isTouch:!!o.touch},e.isDevice=!(!e.isMobile&&!e.isTablet),e}function u(){var e={};return e.isChrome=navigator.userAgent.indexOf("Chrome")>-1,e.isExplorer=navigator.userAgent.indexOf("MSIE")>-1,e.isFirefox=navigator.userAgent.indexOf("Firefox")>-1,e.isSafari=navigator.userAgent.indexOf("Safari")>-1,e.isOpera=navigator.userAgent.indexOf("Presto")>-1,e.isChrome&&e.isSafari&&(e.isSafari=!1),e}pumkin={getTransformValues:a,checkKey:n,svgFallback:i,normalizeBoxHeights:s,randomNum:c,autoFit:l,defineDeviceVariables:d,browserDetection:u,makePlaceholders:r,intelliLoad:h}}(this,this.jQuery,this.Modernizr),function(e,t,o){function a(){e.gv={$window:t(e),$document:t(document),$html:t("html"),$body:t("body"),WIDTH:t(e).width(),HEIGHT:t(e).height(),deviceVariables:n.defineDeviceVariables(),browser:n.browserDetection(),$wrapper:t("#wrapper")},console.log("initGlobal")}var n=e.pumkin;(e.SITE=e.SITE||{}).initGlobal=a}(this,this.jQuery,this.Modernizr),function(e,t,o,a,n){function r(){var o=e.gv;v=o.$window,$=o.$body,b=o.WIDTH,y=o.HEIGHT,g=o.$wrapper,T=o.deviceVariables.isMobile,C=o.deviceVariables.isTablet,w=o.deviceVariables.isDevice,S=o.deviceVariables.isTouch,p=o.browser,$textContent=t(".text-content-column"),$sideCaption=t(".object-side-caption"),$downArrow=t(".down-arrow"),$panelOpenIcon=t(".panel-open-icon"),$objectHeader=t(".object-header"),$creditsOpenBtn=t(".credits"),$overlayCloseBtn=t(".close-overlay"),$overlay=t(".overlay"),$techInfo=t(".technical-info .text-content")}function i(){r(),m(),s(),h(),d(),u(),v.on("resize",h),v.on("resize",x),v.on("resize",I),l(),$textContent.on("scroll",k),console.log("initMain")}function s(){$panelOpenIcon.click(function(){$.hasClass("side-panel-closed")?$.removeClass("side-panel-closed").addClass("side-panel-open"):$.removeClass("side-panel-open side-panel-hint").addClass("side-panel-closed")}),$downArrow.click(function(){console.log("scroll"),t(".object-text").velocity("scroll",{duration:700,offset:-100,easing:"ease-in-out",container:$textContent})}),$creditsOpenBtn.click(function(){$overlay.hasClass("closed")?($overlay.removeClass("closed").addClass("open for-credits"),$overlay.fadeIn(500)):($overlay.removeClass("open for-warning for-credits").addClass("closed"),$overlay.fadeOut(500))}),$overlayCloseBtn.click(function(){$overlay.removeClass("open").addClass("closed"),$overlay.fadeOut(500)}),t(".go-to-options").click(function(){chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():e.open(chrome.runtime.getURL("/src/options/index.html"))})}function c(){$overlay.removeClass("closed").addClass("open for-warning"),$overlay.fadeIn(500)}function l(){var e=$textContent.scrollTop();e>.5*y?$sideCaption.addClass("reveal"):$sideCaption.removeClass("reveal"),e>.5*y?$objectHeader.addClass("hide"):$objectHeader.removeClass("hide")}function h(){b=v.width(),y=v.height()}function d(){console.log("tech info height: "+$techInfo.outerHeight(!0)),console.log("window height: "+y),$techInfo.outerHeight(!0)<y?(console.log("throttle: set middle class on"),$techInfo.addClass("middle")):(console.log("throttle: set middle class off"),$techInfo.removeClass("middle"))}function u(){console.log("debounce")}function m(){n.attach(document.body)}var p,g,f=(e.pumkin,e.SITE=e.SITE||{}),v=null,$=null,b=null,y=null,T=null,C=null,w=null,S=null,k=function(){l()},x=t.throttle(250,function(){d()}),I=t.debounce(100,function(){u()});f.initMain=i,f.throwError=c,f.onThrottledResize=d}(this,this.jQuery,this.Modernizr,this.screenfull,this.FastClick);var vaUrl="https://www.vam.ac.uk/api/json/museumobject/",vaMediaUrl="https://media.vam.ac.uk/media/thira/collection_images/",vaCollectionsUrl="https://collections.vam.ac.uk/item/",defaultSearchTerms=["Architecture","Asia","British Galleries","Ceramics","Childhood","Contemporary","Fashion","Jewellery","Furniture","Glass","Metalwork","Paintings","Drawings","Photography","Prints","Books","Sculpture","Textiles","Theatre"],theSearchTerms,chosenSearchTerm,strictSearch=!1,searchCount=0,maxSearchCounts=5;start();function(e,t){var o=(e.pumkin=e.pumkin||{},e.SITE=e.SITE||{});t(function(){o.initGlobal(),o.initMain()})}(this,this.jQuery);