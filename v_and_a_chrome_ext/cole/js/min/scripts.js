(()=>{"use strict";function e(e,t){return Math.floor(Math.random()*(t-e)+e)}function t(){const e=$("#mobileTester"),t=$("#tabletTester"),i=$("#gutter-tester");return{isMobile:e.is(":visible"),isTablet:t.is(":visible"),isDevice:e.is(":visible")||t.is(":visible"),isTouch:"ontouchstart"in window,gutter:i.is(":visible")}}function i(){const e=navigator.userAgent;let t="unknown";return e.indexOf("Chrome")>-1?t="chrome":e.indexOf("Safari")>-1?t="safari":e.indexOf("Firefox")>-1?t="firefox":(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1)&&(t="ie"),t}function s(){const e=window.gv={$window:$(window),$document:$(document),$html:$("html"),$body:$("body"),WIDTH:$(window).width(),HEIGHT:$(window).height(),deviceVariables:t(),browser:i(),$wrapper:$("#wrapper")};return console.log("initGlobal"),e}window.pumkin=window.pumkin||{},window.pumkin={getTransformValues:function(e,t){const i=e.css("transform").match(/-?[0-9\.]+/g),s=i[0],o={x:i[4]/s,y:i[5]/s};return"scale"===t?s:"translate"===t?o:"raw"===t?i:void 0},checkKey:function(e){return(e=e||window.event).keyCode},makePlaceholders:function(e,t){t=t||"active",$(e).each(function(){const e=$(this),i=e.data().placeholder;e.val(i),""===$.trim(e.val())&&e.val(i).removeClass(t),e.focus(function(){e.val()===i&&e.val("").addClass(t)}).blur(function(){""===$.trim(e.val())&&e.val(i).removeClass(t)})})},svgFallback:function(){$("img[src$='.svg']").each(function(){const e=$(this),t=e.attr("src").replace(".svg",".png");e.attr("src",t)})},normalizeBoxHeights:function(e){let t=0;e.each(function(){t=Math.max($(this).height(),t)}),e.each(function(){$(this).height(t)})},randomNum:e,autoFit:function(e,t,i,s,o,r,a){console.log("autoFit: "+t.length),i=i||0;const n=e.width()-i;t.removeAttr("style");const c=[];let l=0,h=[];t.each(function(){const e=$(this);l+=parseInt(e.css("width"))+i,l<=n?h.push(e):(c.push(h),h=new Array(e),l=parseInt(e.css("width"))+i),e.is(":last-child")&&o&&c.push(h)});const d=c.length;for(let e=0;e<d;e++){const t=c[e].length;let o=0;for(let s=0;s<t;s++)o+=parseInt(c[e][s].css("width"))+i;const r=(n-o)/t,l=o/t;let h=0;if(a){parseInt(c[0][0].css("width"))}for(let o=0;o<t;o++){const t=parseInt(c[e][o].css("width")),n=t/l,d=a?t+r:t+Math.floor(r*n);let u;if(0===e&&0===o){const i=parseInt(c[e][o].css("height"));u=s?Math.floor(d*(i/t)):i}c[e][o].css({width:d+"px",height:u+"px"}),h+=d+i}}},intelliLoad:function(e,t,i){i=i||!1,e.each(function(){const e=$(this),s=t||e.attr("src");if(s){const t=new Image;t.onload=function(){e.attr("src",s),i&&e.addClass("loaded")},t.onerror=function(){console.warn("Failed to load image:",s)},t.src=s}})},defineDeviceVariables:t,browserDetection:i},window.SITE=window.SITE||{},window.SITE.initGlobal=s;class o{constructor(){this.$sidePanel=$(".side-panel"),this.$sidePanelOpenBtn=$(".more"),this.$sidePanelCloseBtn=$(".close-side-panel")}init(){this.bindEvents()}bindEvents(){this.$sidePanelOpenBtn.on("click",()=>this.togglePanel()),this.$sidePanelCloseBtn.on("click",()=>this.closePanel())}togglePanel(){this.$sidePanel.hasClass("open")?this.$sidePanel.removeClass("open"):this.$sidePanel.addClass("open")}closePanel(){this.$sidePanel.removeClass("open")}}class r{constructor(){this.$overlay=$(".overlay"),this.$historyOpenBtn=$(".history"),this.$overlayCloseBtn=$(".close-overlay"),this.$historyObjects=$("#history-objects"),this.$historyWrapper=$(".history-wrapper .loading")}init(){this.bindEvents()}bindEvents(){this.$historyOpenBtn.on("click",()=>this.show()),this.$overlayCloseBtn.on("click",()=>this.hide())}show(){this.$overlay.hasClass("closed")&&(this.$overlay.removeClass("closed").addClass("open for-history"),this.renderHistory(),this.$overlay.fadeIn(500))}hide(){this.$historyObjects.text(""),this.$overlay.fadeOut(500,()=>{this.$overlay.removeClass("open for-history for-warning").addClass("closed")})}renderHistory(){this.$historyWrapper.addClass("loaded");const e=window.theHistory||[];let t=0;e&&0!==e.length?(this.$historyObjects.empty(),e.forEach(e=>{let i="";i+=`<a class="history-object hide-until-loaded" data-object-number="${e.objectNumber}" href="${e.vaCollectionsUrl}" title="View this item in the V&amp;A archive">`,i+=`<div class="history-object-image-holder" style="background-image: url('${e.imageUrl}');"></div>`,i+=`<img src="${e.imageUrl}" class="image-holder-for-loading" id="image-holder-${t}" >`,i+='<div class="history-object-info">',i+=`<p><strong>${e.title}</strong>, ${e.date}</p>`,i+=`<p>${e.artist}</p>`,i+="</div></a>",this.$historyObjects.append(i),$(`#image-holder-${t}`).on("load",function(){$(this).parent().addClass("loaded"),$(this).remove()}),t++})):this.$historyObjects.html('<p class="no-history">No objects viewed yet. Start exploring the V&A collection!</p>')}}class a{constructor(){this.$textContent=null,this.$objectCaption=null,this.$objectHeader=null,this.$downArrow=null,this.HEIGHT=null,this.isInitialized=!1}init(){this.defineVars(),this.bindEvents(),this.isInitialized=!0,console.log("ObjectDisplayComponent initialized")}defineVars(){const e=window.gv;this.HEIGHT=e.HEIGHT,this.$textContent=$(".text-content-column"),this.$objectCaption=$(".object-caption"),this.$objectHeader=$(".object-header"),this.$downArrow=$(".down-arrow")}bindEvents(){this.$downArrow.click(()=>{$("#object-description").velocity("scroll",{duration:700,offset:-100,easing:"ease-in-out",container:this.$textContent})}),this.$textContent.on("scroll",this.throttledScroll.bind(this))}onThrottledScroll(){const e=this.$textContent.scrollTop();e>.5*this.HEIGHT?this.$objectCaption.addClass("reveal"):this.$objectCaption.removeClass("reveal"),e>.5*this.HEIGHT?this.$objectHeader.addClass("hide"):this.$objectHeader.removeClass("hide")}throttledScroll(){this.onThrottledScroll()}updateHeight(e){this.HEIGHT=e}destroy(){this.isInitialized&&(this.$textContent.off("scroll",this.throttledScroll.bind(this)),this.$downArrow.off("click"),this.isInitialized=!1,console.log("ObjectDisplayComponent destroyed"))}}class n{constructor(){this.$overlay=null,this.$overlayCloseBtn=null,this.isInitialized=!1}init(){this.defineVars(),this.bindEvents(),this.isInitialized=!0,console.log("OverlayComponent initialized")}defineVars(){this.$overlay=$(".overlay"),this.$overlayCloseBtn=$(".close-overlay")}bindEvents(){this.$overlayCloseBtn.click(()=>{this.hideOverlay()}),this.$overlay.click(e=>{e.target===this.$overlay[0]&&this.hideOverlay()})}showErrorOverlay(){this.$overlay.removeClass("closed").addClass("open for-warning"),this.$overlay.fadeIn(500)}showOverlay(e=null,t=""){this.$overlay.removeClass("closed").addClass("open"),t&&this.$overlay.addClass(t),e&&this.$overlay.find(".overlay-content").html(e),this.$overlay.fadeIn(500)}hideOverlay(){this.$overlay.removeClass("open for-warning").addClass("closed"),this.$overlay.fadeOut(300)}isVisible(){return this.$overlay.hasClass("open")}destroy(){this.isInitialized&&(this.$overlayCloseBtn.off("click"),this.$overlay.off("click"),this.isInitialized=!1,console.log("OverlayComponent destroyed"))}}window.SITE=window.SITE||{};let c,l,h,d,u,m,p,g,w,b,f,y,v,S=null,T=null,C=null,j=null,I=null,E=null,O=null,k=null,x=[];let A,P,z,H;function R(){!function(){const e=window.gv;S=e.$window,T=e.$body,C=e.WIDTH,j=e.HEIGHT,l=e.$wrapper,I=e.deviceVariables.isMobile,E=e.deviceVariables.isTablet,O=e.deviceVariables.isDevice,k=e.deviceVariables.isTouch,c=e.browser,h=$(".text-content-column"),d=$(".object-caption"),u=$(".down-arrow"),m=$(".object-header"),p=$(".side-panel"),g=$(".more"),w=$(".close-side-panel"),b=$(".history"),f=$(".close-overlay"),y=$(".overlay"),v=$(".technical-info .text-content")}(),"undefined"!=typeof chrome&&void 0!==chrome.storage&&chrome.storage.local.get(["objectHistory"],function(e){e.objectHistory&&(x=e.objectHistory,window.theHistory=x,console.log("Loaded history from storage:",x.length,"items"))}),"undefined"!=typeof FastClick&&FastClick&&FastClick.attach(document.body),A=new o,A.init(),P=new r,P.init(),z=new a,z.init(),H=new n,H.init(),u.click(function(){$("#object-description").velocity("scroll",{duration:700,offset:-100,easing:"ease-in-out",container:h})}),$(".go-to-options").click(function(){chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():window.open(chrome.runtime.getURL("/src/options/index.html"))}),M(),S.on("resize",M),S.on("resize",N),S.on("resize",V),U(),h.on("scroll",_),console.log("initMain")}function U(){const e=h.scrollTop();e>.5*j?d.addClass("reveal"):d.removeClass("reveal"),e>.5*j?m.addClass("hide"):m.removeClass("hide")}window.theHistory=x,window.maxHistoryItems=10;const _=function(){U()};function M(){C=S.width(),j=S.height(),z&&z.updateHeight(j)}function D(){}const N=$.throttle(250,function(){}),V=$.debounce(100,function(){});window.SITE.initMain=R,window.SITE.throwError=function(){H.showErrorOverlay()},window.SITE.onThrottledResize=D;class L{constructor(e={}){this.config={baseUrl:e.baseUrl||"",apiKey:e.apiKey||null,searchEndpoint:e.searchEndpoint||"/search",objectEndpoint:e.objectEndpoint||"/object",...e},this.searchCount=0,this.maxSearchCounts=5,this.currentSearchTerm=null,this.searchTerms=[]}async init(e=[]){this.searchTerms=e,console.log(`${this.constructor.name} initialized with ${e.length} search terms`)}getRandomSearchTerm(){if(0===this.searchTerms.length)throw new Error("No search terms available");const e=Math.floor(Math.random()*this.searchTerms.length);return this.currentSearchTerm=this.searchTerms[e],console.log(`Chosen search term: ${this.currentSearchTerm} from ${this.searchTerms.length} available terms`),this.currentSearchTerm}async searchObjects(e,t={}){throw new Error("searchObjects method must be implemented by subclass")}async getObject(e,t={}){throw new Error("getObject method must be implemented by subclass")}async getRandomObject(e=null,t={}){throw new Error("getRandomObject method must be implemented by subclass")}normalizeObjectData(e){throw new Error("normalizeObjectData method must be implemented by subclass")}canSearch(){return this.searchCount<this.maxSearchCounts}incrementSearchCount(){this.searchCount++}resetSearchCount(){this.searchCount=0}async makeRequest(e,t={}){try{const i=await fetch(e,{headers:{Accept:"application/json",...t.headers},...t});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return await i.json()}catch(e){throw console.error(`API request failed: ${e.message}`),e}}getMuseumName(){throw new Error("getMuseumName method must be implemented by subclass")}getMuseumLogo(){throw new Error("getMuseumLogo method must be implemented by subclass")}}window.SITE=window.SITE||{};const B=new class{constructor(){this.state={currentObject:null,api:{isLoading:!1,error:null,searchCount:0,maxSearchCounts:5},ui:{sidePanelOpen:!1,overlayVisible:!1,overlayType:null,scrollPosition:0,windowSize:{width:0,height:0}},history:{items:[],maxItems:10},settings:{searchTerms:[],strictSearch:!1,museum:"vanda"}},this.listeners=new Map,this.nextListenerId=1}getState(){return{...this.state}}getStateSlice(e){return e.split(".").reduce((e,t)=>null==e?void 0:e[t],this.state)}updateState(e){const t={...this.state};this.state=this.deepMerge(this.state,e),this.notifyListeners(t,this.state)}updateStateSlice(e,t){const i=e.split("."),s={};let o=s;for(let e=0;e<i.length-1;e++)o[i[e]]={},o=o[i[e]];o[i[i.length-1]]=t,this.updateState(s)}subscribe(e){const t=this.nextListenerId++;return this.listeners.set(t,e),()=>{this.listeners.delete(t)}}subscribeToSlice(e,t){return this.subscribe((i,s)=>{const o=this.getStateSlice.call({state:i},e),r=this.getStateSlice.call({state:s},e);JSON.stringify(o)!==JSON.stringify(r)&&t(r,o)})}notifyListeners(e,t){this.listeners.forEach(i=>{try{i(e,t)}catch(e){console.error("State listener error:",e)}})}deepMerge(e,t){const i={...e};for(const e in t)t[e]&&"object"==typeof t[e]&&!Array.isArray(t[e])?i[e]=this.deepMerge(i[e]||{},t[e]):i[e]=t[e];return i}setCurrentObject(e){this.updateStateSlice("currentObject",e)}setApiLoading(e){this.updateStateSlice("api.isLoading",e)}setApiError(e){this.updateStateSlice("api.error",e)}incrementSearchCount(){const e=this.getStateSlice("api.searchCount");this.updateStateSlice("api.searchCount",e+1)}resetSearchCount(){this.updateStateSlice("api.searchCount",0)}canSearch(){const{searchCount:e,maxSearchCounts:t}=this.getStateSlice("api");return e<t}toggleSidePanel(){const e=this.getStateSlice("ui.sidePanelOpen");this.updateStateSlice("ui.sidePanelOpen",!e)}showOverlay(e="info"){this.updateState({ui:{...this.state.ui,overlayVisible:!0,overlayType:e}})}hideOverlay(){this.updateState({ui:{...this.state.ui,overlayVisible:!1,overlayType:null}})}addToHistory(e){const t=this.getStateSlice("history"),i=[e,...t.items.filter(t=>t.id!==e.id)];this.updateState({history:{...t,items:i.slice(0,t.maxItems)}})}updateWindowSize(e,t){this.updateState({ui:{...this.state.ui,windowSize:{width:e,height:t}}})}updateScrollPosition(e){this.updateStateSlice("ui.scrollPosition",e)}async loadSettings(){if("undefined"!=typeof chrome&&void 0!==chrome.storage)return new Promise(e=>{chrome.storage.sync.get({userSearchTerms:"",strictSearch:"fuzzy",museum:"vanda"},t=>{const i=t.userSearchTerms.length>0?t.userSearchTerms.replace(/ /g,"+").split(","):[];this.updateState({settings:{searchTerms:i,strictSearch:"strict"===t.strictSearch,museum:t.museum}}),e()})})}async saveSettings(){if("undefined"!=typeof chrome&&void 0!==chrome.storage){const e=this.getStateSlice("settings");return new Promise(t=>{chrome.storage.sync.set({userSearchTerms:e.searchTerms.join(","),strictSearch:e.strictSearch?"strict":"fuzzy",museum:e.museum},t)})}}},F=new class extends L{constructor(){super({baseUrl:"https://api.vam.ac.uk/v2",searchEndpoint:"/objects/search",objectEndpoint:"/objects",mediaUrl:"https://media.vam.ac.uk/media/thira/collection_images/",collectionsUrl:"https://collections.vam.ac.uk/item/"}),this.defaultSearchTerms=["Architecture","Asia","British Galleries","Ceramics","Childhood","Contemporary","Fashion","Jewellery","Furniture","Glass","Metalwork","Paintings","Drawings","Photography","Prints","Books","Sculpture","Textiles","Theatre"],this.strictSearch=!1}async init(e=null,t=!1){this.strictSearch=t,e&&0!==e.length||(e=this.defaultSearchTerms),await super.init(e);const i=this.searchTerms.join(", ");$("#search-terms").text(i)}async makeRequest(e,t={}){const i=new URL(e),s={};for(const[e,t]of i.searchParams)s[e]=t;const o=s.kw_system_number||null,r=s.q||null,a=s.page?(parseInt(s.page)-1)*parseInt(s.page_size||"1"):null,n=s.page_size||"1";return new Promise((e,t)=>{"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage?(console.log("Sending message to background script..."),chrome.runtime.sendMessage({action:"makeVaRequest",params:{systemNumber:o,searchTerm:r,offset:a,limit:n,withImages:"1",withDescription:"1",hasImage:"1"}},function(i){console.log("Received response from background script:",i),i&&i.success?(console.log("API request successful"),e(i.data)):(console.log("API request failed:",i?i.error:"No response"),t(new Error(i?i.error:"No response from background script")))})):(console.log("Running as standalone page - API requests will fail due to CORS"),t(new Error("Chrome extension context not available")))})}async searchObjects(e,t={}){if(!this.canSearch())throw new Error("Maximum search attempts reached");this.incrementSearchCount();const i=new URLSearchParams({q:e||this.getRandomSearchTerm(),page_size:t.limit||"1",page:"1"}),s=`${this.config.baseUrl}${this.config.searchEndpoint}?${i}`;try{const e=await this.makeRequest(s);return this.normalizeSearchResults(e)}catch(e){throw console.error("V&A search failed:",e),e}}async getRandomObject(t=null,i={}){try{const s=await this.searchObjects(t,{limit:"1"});if(!s.totalCount||0===s.totalCount)throw new Error("No objects found for search term");const o=e(0,s.totalCount-1),r=await this.searchObjects(t,{...i,limit:"1",offset:o});if(0===r.objects.length)throw new Error("No object found at random offset");const a=r.objects[0].id;return await this.getObject(a,i)}catch(e){throw console.error("Failed to get random object:",e),e}}async getObject(e,t={}){const i=new URLSearchParams({kw_system_number:e,page_size:"1",page:"1"}),s=`${this.config.baseUrl}${this.config.searchEndpoint}?${i}`;try{const e=await this.makeRequest(s);return this.normalizeObjectData(e)}catch(e){throw console.error("Failed to get object:",e),e}}normalizeSearchResults(e){var t,i;return{totalCount:(null===(t=e.info)||void 0===t?void 0:t.record_count)||0,objects:(null===(i=e.records)||void 0===i?void 0:i.map(e=>this.normalizeObjectData({records:[e]})))||[],info:e.info}}normalizeObjectData(e){var t,i,s,o,r,a,n;if(!e.records||0===e.records.length)throw new Error("No object data found");const c=e.records[0];let l="";return c._primaryImageId&&(l=`https://framemark.vam.ac.uk/collections/${c._primaryImageId}/full/2500,/0/default.jpg`),{id:c.systemNumber,title:c._primaryTitle||"Untitled",description:c._primaryDescription||"",date:c._primaryDate||"",maker:(null===(t=c._primaryMaker)||void 0===t?void 0:t.name)||"",makerAssociation:(null===(i=c._primaryMaker)||void 0===i?void 0:i.association)||"",place:c._primaryPlace||"",objectType:c.objectType||"",accessionNumber:c.accessionNumber||"",currentLocation:(null===(s=c._currentLocation)||void 0===s?void 0:s.displayName)||"",onDisplay:(null===(o=c._currentLocation)||void 0===o?void 0:o.onDisplay)||!1,imageId:c._primaryImageId,imageUrl:l,thumbnailUrl:(null===(r=c._images)||void 0===r?void 0:r._primary_thumbnail)||"",imageBaseUrl:(null===(a=c._images)||void 0===a?void 0:a._iiif_image_base_url)||"",manifestUrl:(null===(n=c._images)||void 0===n?void 0:n._iiif_presentation_url)||"",collectionUrl:`${this.config.collectionsUrl}${c.systemNumber}`,raw:c}}getMuseumName(){return"Victoria and Albert Museum"}getMuseumLogo(){return"https://www.vam.ac.uk/static/images/logo.png"}async start(){if(console.log("=== V&A API START FUNCTION CALLED ==="),"undefined"!=typeof chrome&&void 0!==chrome.storage)return new Promise(e=>{chrome.storage.sync.get({userSearchTerms:"",strictSearch:"fuzzy"},async t=>{let i=this.defaultSearchTerms,s=!1;t.userSearchTerms.length>0&&(i=t.userSearchTerms.replace(/ /g,"+").split(",")),"strict"===t.strictSearch&&(s=!0),await this.init(i,s);try{const t=await this.getRandomObject();this.displayObject(t),e(t)}catch(t){console.error("Failed to get random object:",t),SITE.throwError(),e(null)}})});await this.init();try{const e=await this.getRandomObject();return this.displayObject(e),e}catch(e){return console.error("Failed to get random object:",e),SITE.throwError(),null}}displayObject(e){window.SITE&&window.SITE.displayObject&&window.SITE.displayObject(e)}};async function q(){console.log("=== NEW API INTEGRATION START FUNCTION CALLED ===");try{await B.loadSettings();const e=B.getStateSlice("settings");await F.init(e.searchTerms,e.strictSearch);const t=await F.getRandomObject();B.setCurrentObject(t),B.addToHistory(t),G(t),console.log("API integration completed successfully")}catch(e){console.error("API integration failed:",e),B.setApiError(e.message),SITE.throwError()}}function G(e){console.log("Displaying object:",e);const{id:t,title:i,description:s,date:o,maker:r,makerAssociation:a,place:n,objectType:c,accessionNumber:l,currentLocation:h,imageUrl:d,collectionUrl:u,raw:m}=e;let p=i.replace(/\^/,"");p=p.replace(/\<i\>/g,""),p=p.replace(/\<\\i\>/g,""),p=p.replace(/\<b\>/g,""),p=p.replace(/\<\\b\>/g,"");const g=a||"",w="<strong>"+p+" "+o+"</strong> &mdash; "+r+" "+g;let b=s;if(!b||""===b.trim()){const e=[];p&&p!==c&&e.push(p),o&&e.push("Dated "+o),n&&e.push("from "+n),r&&"Unknown"!==r&&e.push("by "+r),b=e.length>0?e.join(", ")+".":"A "+c+" from the V&A collection."}b=b.replace(/Object Type\n/g,""),b=b.replace(/People\n/g,""),b=b.replace(/Place\n/g,""),b=b.replace(/Places\n/g,""),b=b.replace(/Time\n/g,""),b=b.replace(/Design \& Designing\n/g,""),b=b.replace(/Design\n/g,""),b=b.replace(/Subject Depicted\n/g,""),b=b.replace(/Subjects Depicted\n/g,""),b=b.replace(/Materials \& Making\n/g,""),b=b.replace(/Collectors \& Owners\n/g,""),b=b.replace(/Ownership \& Use\n/g,""),b=b.replace(/Trading\n/g,""),b=b.replace(/Trade\n/g,""),b=b.replace(/Historical Associations\n/g,""),b=b.replace(/Other\n/g,""),b=b.replace(/\n\n\n/g,"\n\n"),b=b.replace(/\n/g,"<br>"),b=b.replace(/\<i\>/g,""),b=b.replace(/\<\\i\>/g,""),b=b.replace(/\<b\>/g,""),b=b.replace(/\<\\b\>/g,"");const f=o||"";let y="https://www.pinterest.com/pin/create/button/";if(y+="?url="+u,y+="&media="+d,y+="&description="+p,""!=f&&(y+=" ("+n+", "+f+")"),y+=", V%26A Collection",p.length>42&&($("#title").addClass("reduced"),$("#piece-date").addClass("reduced")),$("#creator-name").text(r),$("#dates-alive").text(g),$("#title").html(p),""!=f&&$("#piece-date").text("("+f+")"),$("#place").html(n),d&&""!==d)$("#image").attr("src",d),$("#pinterest-button").attr("href",y);else{$(".object-image-wrapper").html('<div class="image-placeholder"><p>Image not available</p><p><small>This object may not have been photographed yet, or the image may be temporarily unavailable.</small></p></div>')}$("#page-link").attr("href",u),console.log("UI Updates - Setting title to:",p),console.log("UI Updates - Setting artist to:",r),console.log("UI Updates - Setting image to:",d);const v=b&&""!==b.trim()?b:"No description available for this object.";$("#object-description").html("<p>"+v+"</p>"),$("#object-side-caption").html(w),""!=f?$("#tech-info-piece-date").text(f):($("#tech-info-piece-date").hide(),$("#tech-info-piece-date").prev("h4").hide()),""!=r?$("#tech-info-creator-name").text(r):($("#tech-info-creator-name").hide(),$("#tech-info-creator-name").prev("h4").hide()),""!=n?$("#tech-info-place").text(n):($("#tech-info-place").hide(),$("#tech-info-place").prev("h4").hide()),""!=h?$("#museum-location").text(h):($("#museum-location").hide(),$("#museum-location").prev("h4").hide()),""!=l?$("#museum-number").text(l):($("#museum-number").hide(),$("#museum-number").prev("h4").hide()),SITE.onThrottledResize(),$(".content-placeholder, .hide-until-loaded").addClass("loaded"),d&&""!==d?$("img.image-hide-until-loaded").on("load",function(){$(".image-hide-until-loaded, .hide-after-loaded").addClass("loaded"),$(this).removeClass("image-error")}).on("error",function(){console.log("Image failed to load:",d);$(this).closest(".object-image-wrapper").html('<div class="image-placeholder"><p>Image not available</p><p><small>This object may not have been photographed yet, or the image may be temporarily unavailable.</small></p></div>'),$(".image-hide-until-loaded, .hide-after-loaded").addClass("loaded")}):$(".image-hide-until-loaded, .hide-after-loaded").addClass("loaded"),console.log("Object displayed and saved to history")}window.SITE.start=q,window.SITE.makeVaRequest=async function e(t,i,s,o,r,a,n,c){try{if(B.setApiLoading(!0),!B.canSearch())throw new Error("Maximum search attempts reached");let e;B.incrementSearchCount(),e=t?await F.getObject(t,{withImages:r||"1",withDescription:a||"1"}):await F.getRandomObject(i,{limit:o||"1",offset:s,withImages:r||"1",withDescription:a||"1"}),B.setCurrentObject(e),B.addToHistory(e),G(e),B.setApiLoading(!1)}catch(i){if(console.error("makeVaRequest failed:",i),B.setApiError(i.message),B.setApiLoading(!1),t)SITE.throwError();else{const t=F.getRandomSearchTerm();await e(null,t,s,o,r,a,n,c)}}},window.SITE.processResponse=function(e,t){if(console.log("processResponse called with data:",e),e&&e.id)G(e);else if(e&&e.records){G(F.normalizeObjectData(e))}},window.SITE.getApi=function(){return F},window.SITE.getState=function(){return B},window.SITE=window.SITE||{},$(document).ready(function(){console.log("=== V&A Chrome Extension Initializing ==="),s(),R(),q(),console.log("=== V&A Chrome Extension Initialized ===")})})();