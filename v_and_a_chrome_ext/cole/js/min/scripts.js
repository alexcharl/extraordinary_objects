(()=>{"use strict";function e(){const e=$("#mobileTester"),t=$("#tabletTester"),i=$("#gutter-tester");return{isMobile:e.is(":visible"),isTablet:t.is(":visible"),isDevice:e.is(":visible")||t.is(":visible"),isTouch:"ontouchstart"in window,gutter:i.is(":visible")}}function t(){const e=navigator.userAgent;let t="unknown";return e.indexOf("Chrome")>-1?t="chrome":e.indexOf("Safari")>-1?t="safari":e.indexOf("Firefox")>-1?t="firefox":(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1)&&(t="ie"),t}function i(){const i=window.gv={$window:$(window),$document:$(document),$html:$("html"),$body:$("body"),WIDTH:$(window).width(),HEIGHT:$(window).height(),deviceVariables:e(),browser:t(),$wrapper:$("#wrapper")};return console.log("initGlobal"),i}window.pumkin=window.pumkin||{},window.pumkin={getTransformValues:function(e,t){const i=e.css("transform").match(/-?[0-9\.]+/g),s=i[0],o={x:i[4]/s,y:i[5]/s};return"scale"===t?s:"translate"===t?o:"raw"===t?i:void 0},checkKey:function(e){return(e=e||window.event).keyCode},makePlaceholders:function(e,t){t=t||"active",$(e).each(function(){const e=$(this),i=e.data().placeholder;e.val(i),""===$.trim(e.val())&&e.val(i).removeClass(t),e.focus(function(){e.val()===i&&e.val("").addClass(t)}).blur(function(){""===$.trim(e.val())&&e.val(i).removeClass(t)})})},svgFallback:function(){$("img[src$='.svg']").each(function(){const e=$(this),t=e.attr("src").replace(".svg",".png");e.attr("src",t)})},normalizeBoxHeights:function(e){let t=0;e.each(function(){t=Math.max($(this).height(),t)}),e.each(function(){$(this).height(t)})},randomNum:function(e,t){return Math.floor(Math.random()*(t-e)+e)},autoFit:function(e,t,i,s,o,r,a){console.log("autoFit: "+t.length),i=i||0;const n=e.width()-i;t.removeAttr("style");const l=[];let c=0,h=[];t.each(function(){const e=$(this);c+=parseInt(e.css("width"))+i,c<=n?h.push(e):(l.push(h),h=new Array(e),c=parseInt(e.css("width"))+i),e.is(":last-child")&&o&&l.push(h)});const d=l.length;for(let e=0;e<d;e++){const t=l[e].length;let o=0;for(let s=0;s<t;s++)o+=parseInt(l[e][s].css("width"))+i;const r=(n-o)/t,c=o/t;let h=0;if(a){parseInt(l[0][0].css("width"))}for(let o=0;o<t;o++){const t=parseInt(l[e][o].css("width")),n=t/c,d=a?t+r:t+Math.floor(r*n);let m;if(0===e&&0===o){const i=parseInt(l[e][o].css("height"));m=s?Math.floor(d*(i/t)):i}l[e][o].css({width:d+"px",height:m+"px"}),h+=d+i}}},intelliLoad:function(e,t,i){i=i||!1,e.each(function(){const e=$(this),s=t||e.attr("src");if(s){const t=new Image;t.onload=function(){e.attr("src",s),i&&e.addClass("loaded")},t.onerror=function(){console.warn("Failed to load image:",s)},t.src=s}})},defineDeviceVariables:e,browserDetection:t},window.SITE=window.SITE||{},window.SITE.initGlobal=i;class s{constructor(){this.$sidePanel=$(".side-panel"),this.$sidePanelOpenBtn=$(".more"),this.$sidePanelCloseBtn=$(".close-side-panel")}init(){this.bindEvents()}bindEvents(){this.$sidePanelOpenBtn.on("click",()=>this.togglePanel()),this.$sidePanelCloseBtn.on("click",()=>this.closePanel())}togglePanel(){this.$sidePanel.hasClass("open")?this.$sidePanel.removeClass("open"):this.$sidePanel.addClass("open")}closePanel(){this.$sidePanel.removeClass("open")}}class o{constructor(){this.$overlay=$(".overlay"),this.$historyOpenBtn=$(".history"),this.$overlayCloseBtn=$(".close-overlay"),this.$historyObjects=$("#history-objects"),this.$historyWrapper=$(".history-wrapper .loading"),this.appState=null}init(){window.SITE&&window.SITE.getState&&(this.appState=window.SITE.getState()),this.bindEvents()}bindEvents(){this.$historyOpenBtn.on("click",()=>this.show()),this.$overlayCloseBtn.on("click",()=>this.hide())}show(){this.$overlay.hasClass("closed")&&(this.$overlay.removeClass("closed").addClass("open for-history"),this.renderHistory(),this.$overlay.fadeIn(500))}hide(){this.$historyObjects.text(""),this.$overlay.fadeOut(500,()=>{this.$overlay.removeClass("open for-history for-warning").addClass("closed")})}renderHistory(){this.$historyWrapper.addClass("loaded");let e=[];if(this.appState){var t;e=(null===(t=this.appState.getState().history)||void 0===t?void 0:t.items)||[]}else e=window.theHistory||[];let i=0;e&&0!==e.length?(this.$historyObjects.empty(),e.forEach(e=>{let t="";t+=`<a class="history-object hide-until-loaded" data-object-number="${e.id||e.objectNumber}" href="${e.collectionUrl||e.vaCollectionsUrl}" title="View this item in the V&amp;A archive">`,t+=`<div class="history-object-image-holder" style="background-image: url('${e.imageUrl}');"></div>`,t+=`<img src="${e.imageUrl}" class="image-holder-for-loading" id="image-holder-${i}" >`,t+='<div class="history-object-info">',t+=`<p><strong>${e.title}</strong>, ${e.date}</p>`,t+=`<p>${e.maker||e.artist}</p>`,t+="</div></a>",this.$historyObjects.append(t),$(`#image-holder-${i}`).on("load",function(){$(this).parent().addClass("loaded"),$(this).remove()}),i++})):this.$historyObjects.html('<p class="no-history">No objects viewed yet. Start exploring the V&A collection!</p>')}}class r{constructor(){this.$textContent=null,this.$objectCaption=null,this.$objectHeader=null,this.$downArrow=null,this.HEIGHT=null,this.isInitialized=!1}init(){this.defineVars(),this.bindEvents(),this.isInitialized=!0,console.log("ObjectDisplayComponent initialized")}defineVars(){const e=window.gv;this.HEIGHT=e.HEIGHT,this.$textContent=$(".text-content-column"),this.$objectCaption=$(".object-caption"),this.$objectHeader=$(".object-header"),this.$downArrow=$(".down-arrow")}bindEvents(){this.$downArrow.click(()=>{$("#object-description").velocity("scroll",{duration:700,offset:-100,easing:"ease-in-out",container:this.$textContent})}),this.$textContent.on("scroll",this.throttledScroll.bind(this))}onThrottledScroll(){const e=this.$textContent.scrollTop();e>.5*this.HEIGHT?this.$objectCaption.addClass("reveal"):this.$objectCaption.removeClass("reveal"),e>.5*this.HEIGHT?this.$objectHeader.addClass("hide"):this.$objectHeader.removeClass("hide")}throttledScroll(){this.onThrottledScroll()}updateHeight(e){this.HEIGHT=e}destroy(){this.isInitialized&&(this.$textContent.off("scroll",this.throttledScroll.bind(this)),this.$downArrow.off("click"),this.isInitialized=!1,console.log("ObjectDisplayComponent destroyed"))}}class a{constructor(){this.$overlay=null,this.$overlayCloseBtn=null,this.isInitialized=!1}init(){this.defineVars(),this.bindEvents(),this.isInitialized=!0,console.log("OverlayComponent initialized")}defineVars(){this.$overlay=$(".overlay"),this.$overlayCloseBtn=$(".close-overlay")}bindEvents(){this.$overlayCloseBtn.click(()=>{this.hideOverlay()}),this.$overlay.click(e=>{e.target===this.$overlay[0]&&this.hideOverlay()})}showErrorOverlay(){this.$overlay.removeClass("closed").addClass("open for-warning"),this.$overlay.fadeIn(500)}showOverlay(e=null,t=""){this.$overlay.removeClass("closed").addClass("open"),t&&this.$overlay.addClass(t),e&&this.$overlay.find(".overlay-content").html(e),this.$overlay.fadeIn(500)}hideOverlay(){this.$overlay.removeClass("open for-warning").addClass("closed"),this.$overlay.fadeOut(300)}isVisible(){return this.$overlay.hasClass("open")}destroy(){this.isInitialized&&(this.$overlayCloseBtn.off("click"),this.$overlay.off("click"),this.isInitialized=!1,console.log("OverlayComponent destroyed"))}}window.SITE=window.SITE||{};let n,l,c,h,d,m,u,p,g,w,y,b,f,v=null,S=null,j=null,T=null,C=null,I=null,E=null,O=null,k=[];let x,H,P,A;function z(){!function(){const e=window.gv;v=e.$window,S=e.$body,j=e.WIDTH,T=e.HEIGHT,l=e.$wrapper,C=e.deviceVariables.isMobile,I=e.deviceVariables.isTablet,E=e.deviceVariables.isDevice,O=e.deviceVariables.isTouch,n=e.browser,c=$(".text-content-column"),h=$(".object-caption"),d=$(".down-arrow"),m=$(".object-header"),u=$(".side-panel"),p=$(".more"),g=$(".close-side-panel"),w=$(".history"),y=$(".close-overlay"),b=$(".overlay"),f=$(".technical-info .text-content")}(),"undefined"!=typeof chrome&&void 0!==chrome.storage&&chrome.storage.local.get(["objectHistory"],function(e){e.objectHistory&&(k=e.objectHistory,window.theHistory=k,console.log("Loaded history from storage:",k.length,"items"))}),"undefined"!=typeof FastClick&&FastClick&&FastClick.attach(document.body),x=new s,x.init(),H=new o,H.init(),P=new r,P.init(),A=new a,A.init(),d.click(function(){$("#object-description").velocity("scroll",{duration:700,offset:-100,easing:"ease-in-out",container:c})}),$(".go-to-options").click(function(){chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():window.open(chrome.runtime.getURL("/src/options/index.html"))}),R(),v.on("resize",R),v.on("resize",D),v.on("resize",V),U(),c.on("scroll",_),console.log("initMain")}function U(){const e=c.scrollTop();e>.5*T?h.addClass("reveal"):h.removeClass("reveal"),e>.5*T?m.addClass("hide"):m.removeClass("hide")}window.theHistory=k,window.maxHistoryItems=10;const _=function(){U()};function R(){j=v.width(),T=v.height(),P&&P.updateHeight(T)}function M(){}const D=$.throttle(250,function(){}),V=$.debounce(100,function(){});window.SITE.initMain=z,window.SITE.throwError=function(){A.showErrorOverlay()},window.SITE.onThrottledResize=M;class L{constructor(e={}){this.config={baseUrl:e.baseUrl||"",apiKey:e.apiKey||null,searchEndpoint:e.searchEndpoint||"/search",objectEndpoint:e.objectEndpoint||"/object",...e},this.searchCount=0,this.maxSearchCounts=5,this.currentSearchTerm=null,this.searchTerms=[]}async init(e=[]){this.searchTerms=e,console.log(`${this.constructor.name} initialized with ${e.length} search terms`)}getRandomSearchTerm(){if(0===this.searchTerms.length)throw new Error("No search terms available");const e=Math.floor(Math.random()*this.searchTerms.length);return this.currentSearchTerm=this.searchTerms[e],console.log(`Chosen search term: ${this.currentSearchTerm} from ${this.searchTerms.length} available terms`),this.currentSearchTerm}async searchObjects(e,t={}){throw new Error("searchObjects method must be implemented by subclass")}async getObject(e,t={}){throw new Error("getObject method must be implemented by subclass")}async getRandomObject(e=null,t={}){throw new Error("getRandomObject method must be implemented by subclass")}normalizeObjectData(e){throw new Error("normalizeObjectData method must be implemented by subclass")}canSearch(){return this.searchCount<this.maxSearchCounts}incrementSearchCount(){this.searchCount++}resetSearchCount(){this.searchCount=0}async makeRequest(e,t={}){try{const i=await fetch(e,{headers:{Accept:"application/json",...t.headers},...t});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return await i.json()}catch(e){throw console.error(`API request failed: ${e.message}`),e}}getMuseumName(){throw new Error("getMuseumName method must be implemented by subclass")}getMuseumLogo(){throw new Error("getMuseumLogo method must be implemented by subclass")}}window.SITE=window.SITE||{};const N=new class{constructor(){this.state={currentObject:null,api:{isLoading:!1,error:null,searchCount:0,maxSearchCounts:5},ui:{sidePanelOpen:!1,overlayVisible:!1,overlayType:null,scrollPosition:0,windowSize:{width:0,height:0}},history:{items:[],maxItems:10},settings:{searchTerms:[],strictSearch:!1,museum:"vanda"}},this.listeners=new Map,this.nextListenerId=1}getState(){return{...this.state}}getStateSlice(e){return e.split(".").reduce((e,t)=>null==e?void 0:e[t],this.state)}updateState(e){const t={...this.state};this.state=this.deepMerge(this.state,e),this.notifyListeners(t,this.state)}updateStateSlice(e,t){const i=e.split("."),s={};let o=s;for(let e=0;e<i.length-1;e++)o[i[e]]={},o=o[i[e]];o[i[i.length-1]]=t,this.updateState(s)}subscribe(e){const t=this.nextListenerId++;return this.listeners.set(t,e),()=>{this.listeners.delete(t)}}subscribeToSlice(e,t){return this.subscribe((i,s)=>{const o=this.getStateSlice.call({state:i},e),r=this.getStateSlice.call({state:s},e);JSON.stringify(o)!==JSON.stringify(r)&&t(r,o)})}notifyListeners(e,t){this.listeners.forEach(i=>{try{i(e,t)}catch(e){console.error("State listener error:",e)}})}deepMerge(e,t){const i={...e};for(const e in t)t[e]&&"object"==typeof t[e]&&!Array.isArray(t[e])?i[e]=this.deepMerge(i[e]||{},t[e]):i[e]=t[e];return i}setCurrentObject(e){this.updateStateSlice("currentObject",e)}setApiLoading(e){this.updateStateSlice("api.isLoading",e)}setApiError(e){this.updateStateSlice("api.error",e)}incrementSearchCount(){const e=this.getStateSlice("api.searchCount");this.updateStateSlice("api.searchCount",e+1)}resetSearchCount(){this.updateStateSlice("api.searchCount",0)}canSearch(){const{searchCount:e,maxSearchCounts:t}=this.getStateSlice("api");return e<t}toggleSidePanel(){const e=this.getStateSlice("ui.sidePanelOpen");this.updateStateSlice("ui.sidePanelOpen",!e)}showOverlay(e="info"){this.updateState({ui:{...this.state.ui,overlayVisible:!0,overlayType:e}})}hideOverlay(){this.updateState({ui:{...this.state.ui,overlayVisible:!1,overlayType:null}})}addToHistory(e){const t=this.getStateSlice("history"),i=[e,...t.items.filter(t=>t.id!==e.id)];this.updateState({history:{...t,items:i.slice(0,t.maxItems)}}),this.saveHistory()}async loadHistory(){if("undefined"!=typeof chrome&&void 0!==chrome.storage)return new Promise(e=>{chrome.storage.local.get(["objectHistory"],t=>{if(t.objectHistory&&Array.isArray(t.objectHistory)){const e=t.objectHistory.map(e=>({id:e.systemNumber||e.objectNumber,title:e.title,date:e.date,maker:e.artist,imageUrl:e.imageUrl,collectionUrl:e.vaCollectionsUrl,...e}));this.updateState({history:{...this.state.history,items:e.slice(0,this.state.history.maxItems)}}),console.log("Loaded history from storage:",e.length,"items")}e()})})}async saveHistory(){if("undefined"!=typeof chrome&&void 0!==chrome.storage){const e=this.getStateSlice("history");return new Promise(t=>{chrome.storage.local.set({objectHistory:e.items},()=>{console.log("History saved to storage:",e.items.length,"items"),t()})})}}updateWindowSize(e,t){this.updateState({ui:{...this.state.ui,windowSize:{width:e,height:t}}})}updateScrollPosition(e){this.updateStateSlice("ui.scrollPosition",e)}async loadSettings(){if("undefined"!=typeof chrome&&void 0!==chrome.storage)return new Promise(e=>{chrome.storage.sync.get({userSearchTerms:"",strictSearch:"fuzzy",museum:"vanda"},t=>{const i=t.userSearchTerms.length>0?t.userSearchTerms.replace(/ /g,"+").split(","):[];this.updateState({settings:{searchTerms:i,strictSearch:"strict"===t.strictSearch,museum:t.museum}}),e()})})}async saveSettings(){if("undefined"!=typeof chrome&&void 0!==chrome.storage){const e=this.getStateSlice("settings");return new Promise(t=>{chrome.storage.sync.set({userSearchTerms:e.searchTerms.join(","),strictSearch:e.strictSearch?"strict":"fuzzy",museum:e.museum},t)})}}},B=new class extends L{constructor(){super({baseUrl:"https://api.vam.ac.uk/v2",searchEndpoint:"/objects/search",objectEndpoint:"/objects",mediaUrl:"https://media.vam.ac.uk/media/thira/collection_images/",collectionsUrl:"https://collections.vam.ac.uk/item/"}),this.defaultSearchTerms=["Architecture","Asia","British Galleries","Ceramics","Childhood","Contemporary","Fashion","Jewellery","Furniture","Glass","Metalwork","Paintings","Drawings","Photography","Prints","Books","Sculpture","Textiles","Theatre"],this.strictSearch=!1}async init(e=null,t=!1){this.strictSearch=t,e&&0!==e.length||(e=this.defaultSearchTerms),await super.init(e);const i=this.searchTerms.join(", ");$("#search-terms").text(i)}async makeRequest(e,t={}){const i=new URL(e),s={};for(const[e,t]of i.searchParams)s[e]=t;const o=s.kw_system_number||null,r=s.q||null,a=s.page?(parseInt(s.page)-1)*parseInt(s.page_size||"1"):null,n=s.page_size||"1";return new Promise((e,t)=>{"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage?(console.log("Sending message to background script..."),chrome.runtime.sendMessage({action:"makeVaRequest",params:{systemNumber:o,searchTerm:r,offset:a,limit:n,withImages:"1",withDescription:"1",hasImage:"1"}},function(i){console.log("Received response from background script:",i),i&&i.success?(console.log("API request successful"),e(i.data)):(console.log("API request failed:",i?i.error:"No response"),t(new Error(i?i.error:"No response from background script")))})):(console.log("Running as standalone page - API requests will fail due to CORS"),t(new Error("Chrome extension context not available")))})}async searchObjects(e,t={}){const i=new URLSearchParams({q:e||this.getRandomSearchTerm(),page_size:t.limit||"1",page:t.page||"1",random:t.random?"1":void 0,images_exist:t.imagesExist?"1":void 0});for(const[e,t]of i.entries())void 0===t&&i.delete(e);const s=`${this.config.baseUrl}${this.config.searchEndpoint}?${i}`;console.log("[V&A API] searchObjects URL:",s);try{var o;const e=await this.makeRequest(s);return console.log("[V&A API] record_count:",null===(o=e.info)||void 0===o?void 0:o.record_count),this.normalizeSearchResults(e)}catch(e){throw console.error("V&A search failed:",e),e}}async getRandomObject(e=null,t={}){try{const i=await this.searchObjects(e,{...t,limit:"1",page:1,random:!0,imagesExist:!0});if(!i.objects.length)throw new Error("No random object found");const s=i.objects[0].id;return await this.getObject(s,t)}catch(e){throw console.error("Failed to get truly random object:",e),e}}async getObject(e,t={}){const i=new URLSearchParams({kw_system_number:e,page_size:"1",page:"1"}),s=`${this.config.baseUrl}${this.config.searchEndpoint}?${i}`;try{const e=await this.makeRequest(s);return this.normalizeObjectData(e)}catch(e){throw console.error("Failed to get object:",e),e}}normalizeSearchResults(e){var t,i;return{totalCount:(null===(t=e.info)||void 0===t?void 0:t.record_count)||0,objects:(null===(i=e.records)||void 0===i?void 0:i.map(e=>this.normalizeObjectData({records:[e]})))||[],info:e.info}}normalizeObjectData(e){var t,i,s,o,r,a,n;if(!e.records||0===e.records.length)throw new Error("No object data found");const l=e.records[0];let c="";return l._primaryImageId&&(c=`https://framemark.vam.ac.uk/collections/${l._primaryImageId}/full/2500,/0/default.jpg`),{id:l.systemNumber,title:l._primaryTitle||"Untitled",description:l._primaryDescription||"",date:l._primaryDate||"",maker:(null===(t=l._primaryMaker)||void 0===t?void 0:t.name)||"",makerAssociation:(null===(i=l._primaryMaker)||void 0===i?void 0:i.association)||"",place:l._primaryPlace||"",objectType:l.objectType||"",accessionNumber:l.accessionNumber||"",currentLocation:(null===(s=l._currentLocation)||void 0===s?void 0:s.displayName)||"",onDisplay:(null===(o=l._currentLocation)||void 0===o?void 0:o.onDisplay)||!1,imageId:l._primaryImageId,imageUrl:c,thumbnailUrl:(null===(r=l._images)||void 0===r?void 0:r._primary_thumbnail)||"",imageBaseUrl:(null===(a=l._images)||void 0===a?void 0:a._iiif_image_base_url)||"",manifestUrl:(null===(n=l._images)||void 0===n?void 0:n._iiif_presentation_url)||"",collectionUrl:`${this.config.collectionsUrl}${l.systemNumber}`,raw:l}}getMuseumName(){return"Victoria and Albert Museum"}getMuseumLogo(){return"https://www.vam.ac.uk/static/images/logo.png"}async start(){if(console.log("=== V&A API START FUNCTION CALLED ==="),"undefined"!=typeof chrome&&void 0!==chrome.storage)return new Promise(e=>{chrome.storage.sync.get({userSearchTerms:"",strictSearch:"fuzzy"},async t=>{let i=this.defaultSearchTerms,s=!1;t.userSearchTerms.length>0&&(i=t.userSearchTerms.replace(/ /g,"+").split(",")),"strict"===t.strictSearch&&(s=!0),await this.init(i,s);try{const t=await this.getRandomObject();this.displayObject(t),e(t)}catch(t){console.error("Failed to get random object:",t),SITE.throwError(),e(null)}})});await this.init();try{const e=await this.getRandomObject();return this.displayObject(e),e}catch(e){return console.error("Failed to get random object:",e),SITE.throwError(),null}}displayObject(e){window.SITE&&window.SITE.displayObject&&window.SITE.displayObject(e)}};async function F(){try{await N.loadSettings(),await N.loadHistory();const e=N.getStateSlice("settings");await B.init(e.searchTerms,e.strictSearch);const t=await B.getRandomObject();return N.setCurrentObject(t),N.addToHistory(t),q(t),t}catch(e){return console.error("Failed to start application:",e),N.setApiError(e.message),SITE.throwError(),null}}function q(e){console.log("Displaying object:",e);const{id:t,title:i,description:s,date:o,maker:r,makerAssociation:a,place:n,objectType:l,accessionNumber:c,currentLocation:h,imageUrl:d,collectionUrl:m,raw:u}=e;let p=i.replace(/\^/,"");p=p.replace(/\<i\>/g,""),p=p.replace(/\<\\i\>/g,""),p=p.replace(/\<b\>/g,""),p=p.replace(/\<\\b\>/g,"");const g=a||"",w="<strong>"+p+" "+o+"</strong> &mdash; "+r+" "+g;let y=s;if(!y||""===y.trim()){const e=[];p&&p!==l&&e.push(p),o&&e.push("Dated "+o),n&&e.push("from "+n),r&&"Unknown"!==r&&e.push("by "+r),y=e.length>0?e.join(", ")+".":"A "+l+" from the V&A collection."}y=y.replace(/Object Type\n/g,""),y=y.replace(/People\n/g,""),y=y.replace(/Place\n/g,""),y=y.replace(/Places\n/g,""),y=y.replace(/Time\n/g,""),y=y.replace(/Design \& Designing\n/g,""),y=y.replace(/Design\n/g,""),y=y.replace(/Subject Depicted\n/g,""),y=y.replace(/Subjects Depicted\n/g,""),y=y.replace(/Materials \& Making\n/g,""),y=y.replace(/Collectors \& Owners\n/g,""),y=y.replace(/Ownership \& Use\n/g,""),y=y.replace(/Trading\n/g,""),y=y.replace(/Trade\n/g,""),y=y.replace(/Historical Associations\n/g,""),y=y.replace(/Other\n/g,""),y=y.replace(/\n\n\n/g,"\n\n"),y=y.replace(/\n/g,"<br>"),y=y.replace(/\<i\>/g,""),y=y.replace(/\<\\i\>/g,""),y=y.replace(/\<b\>/g,""),y=y.replace(/\<\\b\>/g,"");const b=o||"";let f="https://www.pinterest.com/pin/create/button/";if(f+="?url="+m,f+="&media="+d,f+="&description="+p,""!=b&&(f+=" ("+n+", "+b+")"),f+=", V%26A Collection",p.length>42&&($("#title").addClass("reduced"),$("#piece-date").addClass("reduced")),$("#creator-name").text(r),$("#dates-alive").text(g),$("#title").html(p),""!=b&&$("#piece-date").text("("+b+")"),$("#place").html(n),d&&""!==d)$("#image").attr("src",d),$("#pinterest-button").attr("href",f);else{$(".object-image-wrapper").html('<div class="image-placeholder"><p>Image not available</p><p><small>This object may not have been photographed yet, or the image may be temporarily unavailable.</small></p></div>')}$("#page-link").attr("href",m),console.log("UI Updates - Setting title to:",p),console.log("UI Updates - Setting artist to:",r),console.log("UI Updates - Setting image to:",d);const v=y&&""!==y.trim()?y:"No description available for this object.";$("#object-description").html("<p>"+v+"</p>"),$("#object-side-caption").html(w),""!=b?$("#tech-info-piece-date").text(b):($("#tech-info-piece-date").hide(),$("#tech-info-piece-date").prev("h4").hide()),""!=r?$("#tech-info-creator-name").text(r):($("#tech-info-creator-name").hide(),$("#tech-info-creator-name").prev("h4").hide()),""!=n?$("#tech-info-place").text(n):($("#tech-info-place").hide(),$("#tech-info-place").prev("h4").hide()),""!=h?$("#museum-location").text(h):($("#museum-location").hide(),$("#museum-location").prev("h4").hide()),""!=c?$("#museum-number").text(c):($("#museum-number").hide(),$("#museum-number").prev("h4").hide()),SITE.onThrottledResize(),$(".content-placeholder, .hide-until-loaded").addClass("loaded"),d&&""!==d?$("img.image-hide-until-loaded").on("load",function(){$(".image-hide-until-loaded, .hide-after-loaded").addClass("loaded"),$(this).removeClass("image-error")}).on("error",function(){console.log("Image failed to load:",d);$(this).closest(".object-image-wrapper").html('<div class="image-placeholder"><p>Image not available</p><p><small>This object may not have been photographed yet, or the image may be temporarily unavailable.</small></p></div>'),$(".image-hide-until-loaded, .hide-after-loaded").addClass("loaded")}):$(".image-hide-until-loaded, .hide-after-loaded").addClass("loaded"),console.log("Object displayed and saved to history")}window.SITE.start=F,window.SITE.makeVaRequest=async function e(t,i,s,o,r,a,n,l){try{if(N.setApiLoading(!0),!N.canSearch())throw new Error("Maximum search attempts reached");let e;N.incrementSearchCount(),e=t?await B.getObject(t,{withImages:r||"1",withDescription:a||"1"}):await B.getRandomObject(i,{limit:o||"1",offset:s,withImages:r||"1",withDescription:a||"1"}),N.setCurrentObject(e),N.addToHistory(e),q(e),N.setApiLoading(!1)}catch(i){if(console.error("makeVaRequest failed:",i),N.setApiError(i.message),N.setApiLoading(!1),t)SITE.throwError();else{const t=B.getRandomSearchTerm();await e(null,t,s,o,r,a,n,l)}}},window.SITE.processResponse=function(e,t){if(console.log("processResponse called with data:",e),e&&e.id)q(e);else if(e&&e.records){q(B.normalizeObjectData(e))}},window.SITE.getApi=function(){return B},window.SITE.getState=function(){return N},window.SITE=window.SITE||{},$(document).ready(function(){console.log("=== V&A Chrome Extension Initializing ==="),i(),z(),F(),console.log("=== V&A Chrome Extension Initialized ===")})})();