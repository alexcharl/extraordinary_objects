(()=>{"use strict";function e(){const e=$("#mobileTester"),t=$("#tabletTester"),i=$("#gutter-tester");return{isMobile:e.is(":visible"),isTablet:t.is(":visible"),isDevice:e.is(":visible")||t.is(":visible"),isTouch:"ontouchstart"in window,gutter:i.is(":visible")}}function t(){const e=navigator.userAgent;let t="unknown";return e.indexOf("Chrome")>-1?t="chrome":e.indexOf("Safari")>-1?t="safari":e.indexOf("Firefox")>-1?t="firefox":(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1)&&(t="ie"),t}function i(){const i=window.gv={$window:$(window),$document:$(document),$html:$("html"),$body:$("body"),WIDTH:$(window).width(),HEIGHT:$(window).height(),deviceVariables:e(),browser:t(),$wrapper:$("#wrapper")};return console.log("initGlobal"),i}window.pumkin=window.pumkin||{},window.pumkin={getTransformValues:function(e,t){const i=e.css("transform").match(/-?[0-9\.]+/g),s=i[0],o={x:i[4]/s,y:i[5]/s};return"scale"===t?s:"translate"===t?o:"raw"===t?i:void 0},checkKey:function(e){return(e=e||window.event).keyCode},makePlaceholders:function(e,t){t=t||"active",$(e).each(function(){const e=$(this),i=e.data().placeholder;e.val(i),""===$.trim(e.val())&&e.val(i).removeClass(t),e.focus(function(){e.val()===i&&e.val("").addClass(t)}).blur(function(){""===$.trim(e.val())&&e.val(i).removeClass(t)})})},svgFallback:function(){$("img[src$='.svg']").each(function(){const e=$(this),t=e.attr("src").replace(".svg",".png");e.attr("src",t)})},normalizeBoxHeights:function(e){let t=0;e.each(function(){t=Math.max($(this).height(),t)}),e.each(function(){$(this).height(t)})},randomNum:function(e,t){return Math.floor(Math.random()*(t-e)+e)},autoFit:function(e,t,i,s,o,r,a){console.log("autoFit: "+t.length),i=i||0;const n=e.width()-i;t.removeAttr("style");const c=[];let l=0,h=[];t.each(function(){const e=$(this);l+=parseInt(e.css("width"))+i,l<=n?h.push(e):(c.push(h),h=new Array(e),l=parseInt(e.css("width"))+i),e.is(":last-child")&&o&&c.push(h)});const d=c.length;for(let e=0;e<d;e++){const t=c[e].length;let o=0;for(let s=0;s<t;s++)o+=parseInt(c[e][s].css("width"))+i;const r=(n-o)/t,l=o/t;let h=0;if(a){parseInt(c[0][0].css("width"))}for(let o=0;o<t;o++){const t=parseInt(c[e][o].css("width")),n=t/l,d=a?t+r:t+Math.floor(r*n);let m;if(0===e&&0===o){const i=parseInt(c[e][o].css("height"));m=s?Math.floor(d*(i/t)):i}c[e][o].css({width:d+"px",height:m+"px"}),h+=d+i}}},intelliLoad:function(e,t,i){i=i||!1,e.each(function(){const e=$(this),s=t||e.attr("src");if(s){const t=new Image;t.onload=function(){e.attr("src",s),i&&e.addClass("loaded")},t.onerror=function(){console.warn("Failed to load image:",s)},t.src=s}})},defineDeviceVariables:e,browserDetection:t},window.SITE=window.SITE||{},window.SITE.initGlobal=i;class s{constructor(){this.$sidePanel=$(".side-panel"),this.$sidePanelOpenBtn=$(".more"),this.$sidePanelCloseBtn=$(".close-side-panel")}init(){this.bindEvents()}bindEvents(){this.$sidePanelOpenBtn.on("click",()=>this.togglePanel()),this.$sidePanelCloseBtn.on("click",()=>this.closePanel())}togglePanel(){this.$sidePanel.hasClass("open")?this.$sidePanel.removeClass("open"):this.$sidePanel.addClass("open")}closePanel(){this.$sidePanel.removeClass("open")}}class o{constructor(){this.$overlay=$(".overlay"),this.$historyOpenBtn=$(".history"),this.$overlayCloseBtn=$(".close-overlay"),this.$historyObjects=$("#history-objects"),this.$historyWrapper=$(".history-wrapper .loading"),this.appState=null}init(){window.SITE&&window.SITE.getState&&(this.appState=window.SITE.getState()),this.bindEvents()}bindEvents(){this.$historyOpenBtn.on("click",()=>this.show()),this.$overlayCloseBtn.on("click",()=>this.hide())}show(){this.$overlay.hasClass("closed")&&(this.$overlay.removeClass("closed").addClass("open for-history"),this.renderHistory(),this.$overlay.fadeIn(500))}hide(){this.$historyObjects.text(""),this.$overlay.fadeOut(500,()=>{this.$overlay.removeClass("open for-history for-warning").addClass("closed")})}renderHistory(){this.$historyWrapper.addClass("loaded");let e=[];if(this.appState){var t;e=(null===(t=this.appState.getState().history)||void 0===t?void 0:t.items)||[]}else e=window.theHistory||[];let i=0;e&&0!==e.length?(this.$historyObjects.empty(),e.forEach(e=>{let t="";t+=`<a class="history-object hide-until-loaded" data-object-number="${e.id||e.objectNumber}" href="${e.collectionUrl||e.vaCollectionsUrl}" title="View this item in the V&amp;A archive">`,t+=`<div class="history-object-image-holder" style="background-image: url('${e.imageUrl}');"></div>`,t+=`<img src="${e.imageUrl}" class="image-holder-for-loading" id="image-holder-${i}" >`,t+='<div class="history-object-info">',t+=`<p><strong>${e.title}</strong>, ${e.date}</p>`,t+=`<p>${e.maker||e.artist}</p>`,t+="</div></a>",this.$historyObjects.append(t),$(`#image-holder-${i}`).on("load",function(){$(this).parent().addClass("loaded"),$(this).remove()}),i++})):this.$historyObjects.html('<p class="no-history">No objects viewed yet. Start exploring the V&A collection!</p>')}}class r{constructor(){this.$textContent=null,this.$objectCaption=null,this.$objectHeader=null,this.$downArrow=null,this.HEIGHT=null,this.isInitialized=!1}init(){this.defineVars(),this.bindEvents(),this.isInitialized=!0,console.log("ObjectDisplayComponent initialized")}defineVars(){const e=window.gv;this.HEIGHT=e.HEIGHT,this.$textContent=$(".text-content-column"),this.$objectCaption=$(".object-caption"),this.$objectHeader=$(".object-header"),this.$downArrow=$(".down-arrow")}bindEvents(){this.$downArrow.click(()=>{$("#object-description").velocity("scroll",{duration:700,offset:-100,easing:"ease-in-out",container:this.$textContent})}),this.$textContent.on("scroll",this.throttledScroll.bind(this))}onThrottledScroll(){const e=this.$textContent.scrollTop();e>.5*this.HEIGHT?this.$objectCaption.addClass("reveal"):this.$objectCaption.removeClass("reveal"),e>.5*this.HEIGHT?this.$objectHeader.addClass("hide"):this.$objectHeader.removeClass("hide")}throttledScroll(){this.onThrottledScroll()}updateHeight(e){this.HEIGHT=e}destroy(){this.isInitialized&&(this.$textContent.off("scroll",this.throttledScroll.bind(this)),this.$downArrow.off("click"),this.isInitialized=!1,console.log("ObjectDisplayComponent destroyed"))}}class a{constructor(){this.$overlay=null,this.$overlayCloseBtn=null,this.isInitialized=!1}init(){this.defineVars(),this.bindEvents(),this.isInitialized=!0,console.log("OverlayComponent initialized")}defineVars(){this.$overlay=$(".overlay"),this.$overlayCloseBtn=$(".close-overlay")}bindEvents(){this.$overlayCloseBtn.click(()=>{this.hideOverlay()}),this.$overlay.click(e=>{e.target===this.$overlay[0]&&this.hideOverlay()})}showErrorOverlay(){this.$overlay.removeClass("closed").addClass("open for-warning"),this.$overlay.fadeIn(500)}showOverlay(e=null,t=""){this.$overlay.removeClass("closed").addClass("open"),t&&this.$overlay.addClass(t),e&&this.$overlay.find(".overlay-content").html(e),this.$overlay.fadeIn(500)}hideOverlay(){this.$overlay.removeClass("open for-warning").addClass("closed"),this.$overlay.fadeOut(300)}isVisible(){return this.$overlay.hasClass("open")}destroy(){this.isInitialized&&(this.$overlayCloseBtn.off("click"),this.$overlay.off("click"),this.isInitialized=!1,console.log("OverlayComponent destroyed"))}}window.SITE=window.SITE||{};let n,c,l,h,d,m,u,p,g,f,y,b,w,v=null,S=null,j=null,T=null,C=null,I=null,E=null,O=null,x=[];let _,k,A,P;function H(){!function(){const e=window.gv;v=e.$window,S=e.$body,j=e.WIDTH,T=e.HEIGHT,c=e.$wrapper,C=e.deviceVariables.isMobile,I=e.deviceVariables.isTablet,E=e.deviceVariables.isDevice,O=e.deviceVariables.isTouch,n=e.browser,l=$(".text-content-column"),h=$(".object-caption"),d=$(".down-arrow"),m=$(".object-header"),u=$(".side-panel"),p=$(".more"),g=$(".close-side-panel"),f=$(".history"),y=$(".close-overlay"),b=$(".overlay"),w=$(".technical-info .text-content")}(),"undefined"!=typeof chrome&&void 0!==chrome.storage&&chrome.storage.local.get(["objectHistory"],function(e){e.objectHistory&&(x=e.objectHistory,window.theHistory=x,console.log("Loaded history from storage:",x.length,"items"))}),"undefined"!=typeof FastClick&&FastClick&&FastClick.attach(document.body),_=new s,_.init(),k=new o,k.init(),A=new r,A.init(),P=new a,P.init(),d.click(function(){$("#object-description").velocity("scroll",{duration:700,offset:-100,easing:"ease-in-out",container:l})}),$(".go-to-options").click(function(){chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():window.open(chrome.runtime.getURL("/src/options/index.html"))}),D(),v.on("resize",D),v.on("resize",R),v.on("resize",V),z(),l.on("scroll",M),console.log("initMain")}function z(){const e=l.scrollTop();e>.5*T?h.addClass("reveal"):h.removeClass("reveal"),e>.5*T?m.addClass("hide"):m.removeClass("hide")}window.theHistory=x,window.maxHistoryItems=10;const M=function(){z()};function D(){j=v.width(),T=v.height(),A&&A.updateHeight(T)}function U(){}const R=$.throttle(250,function(){}),V=$.debounce(100,function(){});window.SITE.initMain=H,window.SITE.throwError=function(){P.showErrorOverlay()},window.SITE.onThrottledResize=U;class q{constructor(e={}){this.config={baseUrl:e.baseUrl||"",apiKey:e.apiKey||null,searchEndpoint:e.searchEndpoint||"/search",objectEndpoint:e.objectEndpoint||"/object",...e},this.searchCount=0,this.maxSearchCounts=5,this.currentSearchTerm=null,this.searchTerms=[]}async init(e=[]){this.searchTerms=e,console.log(`${this.constructor.name} initialized with ${e.length} search terms`)}getRandomSearchTerm(){if(0===this.searchTerms.length)throw new Error("No search terms available");const e=Math.floor(Math.random()*this.searchTerms.length);return this.currentSearchTerm=this.searchTerms[e],console.log(`Chosen search term: ${this.currentSearchTerm} from ${this.searchTerms.length} available terms`),this.currentSearchTerm}async searchObjects(e,t={}){throw new Error("searchObjects method must be implemented by subclass")}async getObject(e,t={}){throw new Error("getObject method must be implemented by subclass")}async getRandomObject(e=null,t={}){throw new Error("getRandomObject method must be implemented by subclass")}normalizeObjectData(e){throw new Error("normalizeObjectData method must be implemented by subclass")}canSearch(){return this.searchCount<this.maxSearchCounts}incrementSearchCount(){this.searchCount++}resetSearchCount(){this.searchCount=0}async makeRequest(e,t={}){try{const i=await fetch(e,{headers:{Accept:"application/json",...t.headers},...t});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return await i.json()}catch(e){throw console.error(`API request failed: ${e.message}`),e}}getMuseumName(){throw new Error("getMuseumName method must be implemented by subclass")}getMuseumLogo(){throw new Error("getMuseumLogo method must be implemented by subclass")}}window.SITE=window.SITE||{};const L=new class{constructor(){this.state={currentObject:null,api:{isLoading:!1,error:null,searchCount:0,maxSearchCounts:5},ui:{sidePanelOpen:!1,overlayVisible:!1,overlayType:null,scrollPosition:0,windowSize:{width:0,height:0}},history:{items:[],maxItems:10},settings:{searchTerms:[],strictSearch:!1,museum:"vanda"}},this.listeners=new Map,this.nextListenerId=1}getState(){return{...this.state}}getStateSlice(e){return e.split(".").reduce((e,t)=>null==e?void 0:e[t],this.state)}updateState(e){const t={...this.state};this.state=this.deepMerge(this.state,e),this.notifyListeners(t,this.state)}updateStateSlice(e,t){const i=e.split("."),s={};let o=s;for(let e=0;e<i.length-1;e++)o[i[e]]={},o=o[i[e]];o[i[i.length-1]]=t,this.updateState(s)}subscribe(e){const t=this.nextListenerId++;return this.listeners.set(t,e),()=>{this.listeners.delete(t)}}subscribeToSlice(e,t){return this.subscribe((i,s)=>{const o=this.getStateSlice.call({state:i},e),r=this.getStateSlice.call({state:s},e);JSON.stringify(o)!==JSON.stringify(r)&&t(r,o)})}notifyListeners(e,t){this.listeners.forEach(i=>{try{i(e,t)}catch(e){console.error("State listener error:",e)}})}deepMerge(e,t){const i={...e};for(const e in t)t[e]&&"object"==typeof t[e]&&!Array.isArray(t[e])?i[e]=this.deepMerge(i[e]||{},t[e]):i[e]=t[e];return i}setCurrentObject(e){this.updateStateSlice("currentObject",e)}setApiLoading(e){this.updateStateSlice("api.isLoading",e)}setApiError(e){this.updateStateSlice("api.error",e)}incrementSearchCount(){const e=this.getStateSlice("api.searchCount");this.updateStateSlice("api.searchCount",e+1)}resetSearchCount(){this.updateStateSlice("api.searchCount",0)}canSearch(){const{searchCount:e,maxSearchCounts:t}=this.getStateSlice("api");return e<t}toggleSidePanel(){const e=this.getStateSlice("ui.sidePanelOpen");this.updateStateSlice("ui.sidePanelOpen",!e)}showOverlay(e="info"){this.updateState({ui:{...this.state.ui,overlayVisible:!0,overlayType:e}})}hideOverlay(){this.updateState({ui:{...this.state.ui,overlayVisible:!1,overlayType:null}})}addToHistory(e){const t=this.getStateSlice("history"),i=[e,...t.items.filter(t=>t.id!==e.id)];this.updateState({history:{...t,items:i.slice(0,t.maxItems)}}),this.saveHistory()}async loadHistory(){if("undefined"!=typeof chrome&&void 0!==chrome.storage)return new Promise(e=>{chrome.storage.local.get(["objectHistory"],t=>{if(t.objectHistory&&Array.isArray(t.objectHistory)){const e=t.objectHistory.map(e=>({id:e.systemNumber||e.objectNumber,title:e.title,date:e.date,maker:e.artist,imageUrl:e.imageUrl,collectionUrl:e.vaCollectionsUrl,...e}));this.updateState({history:{...this.state.history,items:e.slice(0,this.state.history.maxItems)}}),console.log("Loaded history from storage:",e.length,"items")}e()})})}async saveHistory(){if("undefined"!=typeof chrome&&void 0!==chrome.storage){const e=this.getStateSlice("history");return new Promise(t=>{chrome.storage.local.set({objectHistory:e.items},()=>{console.log("History saved to storage:",e.items.length,"items"),t()})})}}updateWindowSize(e,t){this.updateState({ui:{...this.state.ui,windowSize:{width:e,height:t}}})}updateScrollPosition(e){this.updateStateSlice("ui.scrollPosition",e)}async loadSettings(){if("undefined"!=typeof chrome&&void 0!==chrome.storage)return new Promise(e=>{chrome.storage.sync.get({userSearchTerms:"",strictSearch:"fuzzy",museum:"vanda"},t=>{const i=t.userSearchTerms.length>0?t.userSearchTerms.replace(/ /g,"+").split(","):[];this.updateState({settings:{searchTerms:i,strictSearch:"strict"===t.strictSearch,museum:t.museum}}),e()})})}async saveSettings(){if("undefined"!=typeof chrome&&void 0!==chrome.storage){const e=this.getStateSlice("settings");return new Promise(t=>{chrome.storage.sync.set({userSearchTerms:e.searchTerms.join(","),strictSearch:e.strictSearch?"strict":"fuzzy",museum:e.museum},t)})}}},N=new class extends q{constructor(){super({baseUrl:"https://api.vam.ac.uk/v2",searchEndpoint:"/objects/search",objectEndpoint:"/objects",mediaUrl:"https://media.vam.ac.uk/media/thira/collection_images/",collectionsUrl:"https://collections.vam.ac.uk/item/"}),this.defaultSearchTerms=["Architecture","Asia","British Galleries","Ceramics","Childhood","Contemporary","Fashion","Jewellery","Furniture","Glass","Metalwork","Paintings","Drawings","Photography","Prints","Books","Sculpture","Textiles","Theatre"],this.strictSearch=!1}async init(e=null,t=!1){this.strictSearch=t,e&&0!==e.length||(e=this.defaultSearchTerms),await super.init(e);const i=this.searchTerms.join(", ");$("#search-terms").text(i)}async makeRequest(e,t={}){const i=new URL(e),s={};for(const[e,t]of i.searchParams)s[e]=t;const o=s.kw_system_number||null,r=s.q||null,a=s.page?(parseInt(s.page)-1)*parseInt(s.page_size||"1"):null,n=s.page_size||"1";return new Promise((e,t)=>{"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage?(console.log("Sending message to background script..."),chrome.runtime.sendMessage({action:"makeVaRequest",params:{systemNumber:o,searchTerm:r,offset:a,limit:n,hasImage:"1"}},function(i){console.log("Received response from background script:",i),i&&i.success?(console.log("API request successful"),e(i.data)):(console.log("API request failed:",i?i.error:"No response"),t(new Error(i?i.error:"No response from background script")))})):(console.log("Running as standalone page - API requests will fail due to CORS"),t(new Error("Chrome extension context not available")))})}async searchObjects(e,t={}){const i=new URLSearchParams({q:e||this.getRandomSearchTerm(),page_size:t.limit||"1",page:t.page||"1",images_exist:t.imagesExist?"1":void 0,image_restrict:"2"});if(void 0!==t.offset&&null!==t.offset){const e=parseInt(t.limit||"1"),s=Math.floor(t.offset/e)+1;i.set("page",s.toString()),console.log(`[V&A API] Converting offset ${t.offset} to page ${s} (page_size: ${e})`)}for(const[e,t]of i.entries())void 0===t&&i.delete(e);const s=`${this.config.baseUrl}${this.config.searchEndpoint}?${i}`;console.log("[V&A API] searchObjects URL:",s);try{var o;const e=await this.makeRequest(s);return console.log("[V&A API] record_count:",null===(o=e.info)||void 0===o?void 0:o.record_count),this.normalizeSearchResults(e)}catch(e){throw console.error("V&A search failed:",e),e}}async getRandomObject(e=null,t={}){try{e||(e=this.getRandomSearchTerm()),console.log(`[V&A API] Getting random object for search term: "${e}"`);const i=(await this.searchObjects(e,{limit:"1",page:1,imagesExist:!0})).totalCount;if(console.log(`[V&A API] Total objects for "${e}": ${i}`),0===i)throw new Error(`No objects found for search term: ${e}`);const s=Math.floor(Math.random()*i);console.log(`[V&A API] Random offset: ${s} (range: 0 to ${i-1})`);const o=await this.searchObjects(e,{limit:"1",offset:s,imagesExist:!0});if(!o.objects.length)throw new Error("No random object found at calculated offset");const r=o.objects[0].id,a=await this.getObject(r,t);return a.searchTerm=e,a}catch(i){if(console.error("Failed to get truly random object:",i),e){console.log("Retrying with different search term...");const e=this.getRandomSearchTerm();return await this.getRandomObject(e,t)}throw i}}async getObject(e,t={}){const i=new URLSearchParams({kw_system_number:e,page_size:"1",page:"1"}),s=`${this.config.baseUrl}${this.config.searchEndpoint}?${i}`;try{const e=await this.makeRequest(s);return this.normalizeObjectData(e)}catch(e){throw console.error("Failed to get object:",e),e}}normalizeSearchResults(e){var t,i;return{totalCount:(null===(t=e.info)||void 0===t?void 0:t.record_count)||0,objects:(null===(i=e.records)||void 0===i?void 0:i.map(e=>this.normalizeObjectData({records:[e]})))||[],info:e.info}}normalizeObjectData(e){var t,i,s,o,r,a,n;if(!e.records||0===e.records.length)throw new Error("No object data found");const c=e.records[0];let l="";c._primaryImageId&&(l=`https://framemark.vam.ac.uk/collections/${c._primaryImageId}/full/2500,/0/default.jpg`);let h="";if(c._primaryMaker&&c._primaryMaker.birthYear){const e=c._primaryMaker.birthYear,t=c._primaryMaker.deathYear;e&&t?h="("+e+" - "+t+")":e&&(h="(Born "+e+")")}let d="";c._materials&&c._materials.length>0&&(d=c._materials.map(e=>e.name).join(", "));let m="";c._techniques&&c._techniques.length>0&&(m=c._techniques.map(e=>e.name).join(", "));let u="";c._subjects&&c._subjects.length>0&&(u=c._subjects.map(e=>e.name).join(", "));let p="";c._physicalDescription&&(p=c._physicalDescription);let g="";c._dimensions&&(g=c._dimensions);let f="";if(c.accessionYear)f=c.accessionYear;else if(c.accessionNumber){const e=c.accessionNumber.match(/(\d{4})/);e&&(f=e[1])}let y="";if(c._primaryDate){const e=c._primaryDate;e.includes("19th century")||e.match(/\d{4}/)&&parseInt(e.match(/\d{4}/)[0])<1900?y="Victorian era":e.includes("18th century")||e.match(/\d{4}/)&&parseInt(e.match(/\d{4}/)[0])<1800?y="Georgian era":e.includes("17th century")||e.match(/\d{4}/)&&parseInt(e.match(/\d{4}/)[0])<1700?y="Stuart era":e.includes("16th century")||e.match(/\d{4}/)&&parseInt(e.match(/\d{4}/)[0])<1600?y="Tudor era":e.includes("20th century")||e.match(/\d{4}/)&&parseInt(e.match(/\d{4}/)[0])>=1900&&parseInt(e.match(/\d{4}/)[0])<2e3?y="Modern era":(e.includes("21st century")||e.match(/\d{4}/)&&parseInt(e.match(/\d{4}/)[0])>=2e3)&&(y="Contemporary era")}let b="";const $=[];return c._primaryDescription&&""!==c._primaryDescription.trim()&&$.push(c._primaryDescription),p&&""!==p.trim()&&p!==c._primaryDescription&&$.push(p),u&&""!==u.trim()&&$.push(`Depicts: ${u}`),m&&""!==m.trim()&&$.push(`Made using: ${m}`),y&&""!==y.trim()&&$.push(`Historical period: ${y}`),f&&""!==f.trim()&&$.push(`Acquired by the V&A in ${f}`),$.length>0&&(b=$.join(". ")),{id:c.systemNumber,title:c._primaryTitle||"Untitled",description:b||c._primaryDescription||"",date:c._primaryDate||"",maker:(null===(t=c._primaryMaker)||void 0===t?void 0:t.name)||"",makerAssociation:(null===(i=c._primaryMaker)||void 0===i?void 0:i.association)||"",datesAlive:h,place:c._primaryPlace||"",objectType:c.objectType||"",accessionNumber:c.accessionNumber||"",currentLocation:(null===(s=c._currentLocation)||void 0===s?void 0:s.displayName)||"",onDisplay:(null===(o=c._currentLocation)||void 0===o?void 0:o.onDisplay)||!1,materials:d,techniques:m,subjects:u,physicalDescription:p,dimensions:g,accessionYear:f,historicalContext:y,imageId:c._primaryImageId,imageUrl:l,thumbnailUrl:(null===(r=c._images)||void 0===r?void 0:r._primary_thumbnail)||"",imageBaseUrl:(null===(a=c._images)||void 0===a?void 0:a._iiif_image_base_url)||"",manifestUrl:(null===(n=c._images)||void 0===n?void 0:n._iiif_presentation_url)||"",collectionUrl:`${this.config.collectionsUrl}${c.systemNumber}`,raw:c}}getMuseumName(){return"Victoria and Albert Museum"}getMuseumLogo(){return"https://www.vam.ac.uk/static/images/logo.png"}async start(){if(console.log("=== V&A API START FUNCTION CALLED ==="),"undefined"!=typeof chrome&&void 0!==chrome.storage)return new Promise(e=>{chrome.storage.sync.get({userSearchTerms:"",strictSearch:"fuzzy"},async t=>{let i=this.defaultSearchTerms,s=!1;t.userSearchTerms.length>0&&(i=t.userSearchTerms.replace(/ /g,"+").split(",")),"strict"===t.strictSearch&&(s=!0),await this.init(i,s);try{const t=await this.getRandomObject();this.displayObject(t),e(t)}catch(t){console.error("Failed to get random object:",t),SITE.throwError(),e(null)}})});await this.init();try{const e=await this.getRandomObject();return this.displayObject(e),e}catch(e){return console.error("Failed to get random object:",e),SITE.throwError(),null}}displayObject(e){window.SITE&&window.SITE.displayObject&&window.SITE.displayObject(e)}};async function B(){try{await L.loadSettings(),await L.loadHistory();const e=L.getStateSlice("settings");await N.init(e.searchTerms,e.strictSearch);const t=await N.getRandomObject();return L.setCurrentObject(t),L.addToHistory(t),F(t),t}catch(e){return console.error("Failed to start application:",e),L.setApiError(e.message),SITE.throwError(),null}}function F(e){console.log("Displaying object:",e);const{id:t,title:i,description:s,date:o,maker:r,makerAssociation:a,datesAlive:n,place:c,objectType:l,accessionNumber:h,currentLocation:d,materials:m,techniques:u,subjects:p,physicalDescription:g,dimensions:f,accessionYear:y,historicalContext:b,searchTerm:w,imageUrl:v,collectionUrl:S,raw:j}=e;let T=i.replace(/\^/,"");T=T.replace(/\<i\>/g,""),T=T.replace(/\<\\i\>/g,""),T=T.replace(/\<b\>/g,""),T=T.replace(/\<\\b\>/g,"");const C="<strong>"+T+" "+o+"</strong> &mdash; "+r+" "+n;let I=s;if(!I||""===I.trim()){const e=[];T&&T!==l&&e.push(T),o&&e.push("Dated "+o),c&&e.push("from "+c),r&&"Unknown"!==r&&e.push("by "+r),I=e.length>0?e.join(", ")+".":"A "+l+" from the V&A collection."}I=I.replace(/Object Type\n/g,""),I=I.replace(/People\n/g,""),I=I.replace(/Place\n/g,""),I=I.replace(/Places\n/g,""),I=I.replace(/Time\n/g,""),I=I.replace(/Design \& Designing\n/g,""),I=I.replace(/Design\n/g,""),I=I.replace(/Subject Depicted\n/g,""),I=I.replace(/Subjects Depicted\n/g,""),I=I.replace(/Materials \& Making\n/g,""),I=I.replace(/Collectors \& Owners\n/g,""),I=I.replace(/Ownership \& Use\n/g,""),I=I.replace(/Trading\n/g,""),I=I.replace(/Trade\n/g,""),I=I.replace(/Historical Associations\n/g,""),I=I.replace(/Other\n/g,""),I=I.replace(/\n\n\n/g,"\n\n"),I=I.replace(/\n/g,"<br>"),I=I.replace(/\<i\>/g,""),I=I.replace(/\<\\i\>/g,""),I=I.replace(/\<b\>/g,""),I=I.replace(/\<\\b\>/g,"");const E=o||"";let O="https://www.pinterest.com/pin/create/button/";if(O+="?url="+S,O+="&media="+v,O+="&description="+T,""!=E&&(O+=" ("+c+", "+E+")"),O+=", V%26A Collection",T.length>42&&($("#title").addClass("reduced"),$("#piece-date").addClass("reduced")),$("#creator-name").text(r),$("#dates-alive").text(n),$("#title").html(T),""!=E&&$("#piece-date").text("("+E+")"),$("#place").html(c),v&&""!==v)$("#image").attr("src",v),$("#pinterest-button").attr("href",O);else{$(".object-image-wrapper").html('<div class="image-placeholder"><p>Image not available</p><p><small>This object may not have been photographed yet, or the image may be temporarily unavailable.</small></p></div>')}$("#page-link").attr("href",S),console.log("UI Updates - Setting title to:",T),console.log("UI Updates - Setting artist to:",r),console.log("UI Updates - Setting image to:",v);let x=s&&""!==s.trim()?s:g&&""!==g.trim()?g:[T,o,c,r].filter(Boolean).join(", ")+".";$("#object-description").html("<p>"+x+"</p>"),$("#object-side-caption").html(C),""!=E?$("#tech-info-piece-date").text(E):($("#tech-info-piece-date").hide(),$("#tech-info-piece-date").prev("h4").hide()),""!=r?$("#tech-info-creator-name").text(r):($("#tech-info-creator-name").hide(),$("#tech-info-creator-name").prev("h4").hide()),""!=c?$("#tech-info-place").text(c):($("#tech-info-place").hide(),$("#tech-info-place").prev("h4").hide()),""!=d?$("#museum-location").text(d):($("#museum-location").hide(),$("#museum-location").prev("h4").hide()),""!=h?$("#museum-number").text(h):($("#museum-number").hide(),$("#museum-number").prev("h4").hide()),""!=w?$("#search-term").text(w):($("#search-term").hide(),$("#search-term").prev("h4").hide()),""!=g?$("#physical-description").html(g):($("#physical-description").hide(),$("#physical-description").prev("h4").hide()),""!=m?$("#tech-info-materials").html(m):($("#tech-info-materials").hide(),$("#tech-info-materials").prev("h4").hide()),""!=u?(0===$("#tech-info-techniques").length&&$("#tech-info-materials").after('<h4>Techniques</h4><p id="tech-info-techniques"></p>'),$("#tech-info-techniques").html(u)):($("#tech-info-techniques").hide(),$("#tech-info-techniques").prev("h4").hide()),""!=p?(0===$("#tech-info-subjects").length&&$("#tech-info-techniques").after('<h4>Subjects</h4><p id="tech-info-subjects"></p>'),$("#tech-info-subjects").html(p)):($("#tech-info-subjects").hide(),$("#tech-info-subjects").prev("h4").hide()),""!=y?(0===$("#tech-info-accession-year").length&&$("#tech-info-subjects").after('<h4>Acquired</h4><p id="tech-info-accession-year"></p>'),$("#tech-info-accession-year").text(y)):($("#tech-info-accession-year").hide(),$("#tech-info-accession-year").prev("h4").hide()),""!=b?(0===$("#tech-info-historical-context").length&&$("#tech-info-accession-year").after('<h4>Historical Period</h4><p id="tech-info-historical-context"></p>'),$("#tech-info-historical-context").text(b)):($("#tech-info-historical-context").hide(),$("#tech-info-historical-context").prev("h4").hide()),""!=f?$("#dimensions").text(f):($("#dimensions").hide(),$("#dimensions").prev("h4").hide()),SITE.onThrottledResize(),$(".content-placeholder, .hide-until-loaded").addClass("loaded"),v&&""!==v?$("img.image-hide-until-loaded").on("load",function(){$(".image-hide-until-loaded, .hide-after-loaded").addClass("loaded"),$(this).removeClass("image-error")}).on("error",function(){console.log("Image failed to load:",v);$(this).closest(".object-image-wrapper").html('<div class="image-placeholder"><p>Image not available</p><p><small>This object may not have been photographed yet, or the image may be temporarily unavailable.</small></p></div>'),$(".image-hide-until-loaded, .hide-after-loaded").addClass("loaded")}):$(".image-hide-until-loaded, .hide-after-loaded").addClass("loaded"),console.log("Object displayed and saved to history")}window.SITE.start=B,window.SITE.makeVaRequest=async function e(t,i,s,o,r,a,n,c){try{if(L.setApiLoading(!0),!L.canSearch())throw new Error("Maximum search attempts reached");let e;L.incrementSearchCount(),e=t?await N.getObject(t):await N.getRandomObject(i,{limit:o||"1",offset:s}),L.setCurrentObject(e),L.addToHistory(e),F(e),L.setApiLoading(!1)}catch(i){if(console.error("makeVaRequest failed:",i),L.setApiError(i.message),L.setApiLoading(!1),t)SITE.throwError();else{const t=N.getRandomSearchTerm();await e(null,t,s,o,r,a,n,c)}}},window.SITE.processResponse=function(e,t){if(console.log("processResponse called with data:",e),e&&e.id)F(e);else if(e&&e.records){F(N.normalizeObjectData(e))}},window.SITE.getApi=function(){return N},window.SITE.getState=function(){return L},window.SITE=window.SITE||{},$(document).ready(function(){console.log("=== V&A Chrome Extension Initializing ==="),i(),H(),B(),console.log("=== V&A Chrome Extension Initialized ===")})})();